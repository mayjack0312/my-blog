# 打造顶级全自动化影音系统

## 目录

- [打造顶级全自动化影音系统](#打造顶级全自动化影音系统)
  - [目录](#目录)
  - [前言](#前言)
  - [TL;DR](#tldr)
  - [硬件需求](#硬件需求)
  - [资源获取](#资源获取)
  - [利用Prowlarr Jackett和FlareSolverr整合资源方便后续搜索](#利用prowlarr-jackett和flaresolverr整合资源方便后续搜索)
  - [利用Sonarr、Radarr、Lidarr和Readarr进行资源分类管理](#利用sonarrradarrlidarr和readarr进行资源分类管理)
  - [利用Ombi来整合Sonarr Radarr和Lidarr的搜索功能](#利用ombi来整合sonarr-radarr和lidarr的搜索功能)
  - [利用qBittorrent(BT/PT)和NZBGet(Usenet)下载资源到本地](#利用qbittorrentbtpt和nzbgetusenet下载资源到本地)
  - [利用Bazarr和Chinesesubfinder下载字幕](#利用bazarr和chinesesubfinder下载字幕)
  - [使用Emby尽情愉快地放飞自我](#使用emby尽情愉快地放飞自我)
  - [流程总结](#流程总结)
  - [手动折腾ing](#手动折腾ing)
    - [文件架构](#文件架构)
    - [新建文件夹](#新建文件夹)
    - [Nginx](#nginx)
      - [安装Nginx](#安装nginx)
      - [配置NGINX主配置文件](#配置nginx主配置文件)
      - [启动Nginx](#启动nginx)
      - [配置子目录以及反向代理](#配置子目录以及反向代理)
      - [新建NGINX配置](#新建nginx配置)
      - [写入新配置](#写入新配置)
      - [修改NGINX默认前端页面以方便进入](#修改nginx默认前端页面以方便进入)
      - [写入以下配置](#写入以下配置)
      - [使配置生效](#使配置生效)
    - [Docker](#docker)
      - [安装Docker](#安装docker)
      - [安装Docker-compose](#安装docker-compose)
    - [Emby](#emby)
      - [安装Emby(新版本需要修改下方命令链接)](#安装emby新版本需要修改下方命令链接)
    - [qBittorrent](#qbittorrent)
      - [安装qBittorrent加强版](#安装qbittorrent加强版)
      - [下载mmdb这样peer的国旗才会显示](#下载mmdb这样peer的国旗才会显示)
      - [修改性能设置](#修改性能设置)
      - [新增分类及对应的下载位置](#新增分类及对应的下载位置)
    - [Docker-compose配置文件及命令行配置](#docker-compose配置文件及命令行配置)
      - [写入Docker-compose配置文件](#写入docker-compose配置文件)
      - [拉取Docker images并等待60秒让程序初始化。](#拉取docker-images并等待60秒让程序初始化)
      - [关闭所有程序进行配置](#关闭所有程序进行配置)
    - [配置 NZBGet](#配置-nzbget)
    - [配置Sonarr](#配置sonarr)
    - [配置Radarr](#配置radarr)
    - [配置Lidarr](#配置lidarr)
    - [配置Readarr](#配置readarr)
    - [配置prowlarr](#配置prowlarr)
    - [配置Jackett](#配置jackett)
    - [配置Bazarr](#配置bazarr)
    - [配置Ombi](#配置ombi)
    - [启动系统](#启动系统)
    - [配置Emby](#配置emby)
      - [打开链接，进行初始化，文件夹路径按照图中设置即可。](#打开链接进行初始化文件夹路径按照图中设置即可)
      - [启用 NFO](#启用-nfo)
      - [勾选这个选项](#勾选这个选项)
      - [新建`电视节目`文件夹](#新建电视节目文件夹)
      - [新建`电影`文件夹](#新建电影文件夹)
      - [新建`音乐`文件夹](#新建音乐文件夹)
      - [新建`书籍`文件夹](#新建书籍文件夹)
      - [新建Emby API](#新建emby-api)
    - [配置Ombi](#配置ombi-1)
      - [打开链接，进行初始化，Emby API复制黏贴即可，其余设置如图所示。](#打开链接进行初始化emby-api复制黏贴即可其余设置如图所示)
    - [检查Sonarr配置](#检查sonarr配置)
      - [重命名配置](#重命名配置)
      - [根目录配置](#根目录配置)
      - [下载客户端配置](#下载客户端配置)
      - [刮削配置](#刮削配置)
      - [影片质量配置](#影片质量配置)
    - [检查Radarr配置](#检查radarr配置)
      - [重命名配置](#重命名配置-1)
      - [根目录配置](#根目录配置-1)
      - [下载客户端配置](#下载客户端配置-1)
      - [刮削配置](#刮削配置-1)
      - [影片质量配置](#影片质量配置-1)
    - [检查Lidarr配置](#检查lidarr配置)
      - [重命名以及根目录配置](#重命名以及根目录配置)
      - [下载客户端配置](#下载客户端配置-2)
      - [刮削配置](#刮削配置-2)
      - [音乐质量配置](#音乐质量配置)
    - [检查Readarr配置](#检查readarr配置)
      - [重命名以及根目录配置](#重命名以及根目录配置-1)
      - [仅需填入名称以及路径，其他不用改。](#仅需填入名称以及路径其他不用改)
      - [下载客户端配置](#下载客户端配置-3)
      - [书籍质量配置](#书籍质量配置)
    - [检查Bazarr配置](#检查bazarr配置)
      - [字幕语言配置](#字幕语言配置)
      - [默认字幕语言配置](#默认字幕语言配置)
      - [下载字幕源](#下载字幕源)
    - [检查Chinesesubfinder配置](#检查chinesesubfinder配置)
      - [基础配置](#基础配置)
      - [Emby以及目录映射配置](#emby以及目录映射配置)
    - [Prowlarr/Jackett配置indexers](#prowlarrjackett配置indexers)
      - [点击`Add indexer`](#点击add-indexer)
      - [选择`Base Url`，点击保存。](#选择base-url点击保存)
      - [有`Cloudflare DDOS`的要加一个`flaresolverr` Tag。](#有cloudflare-ddos的要加一个flaresolverr-tag)
    - [检查qBittorrent配置](#检查qbittorrent配置)
      - [检查分类是否正确显示](#检查分类是否正确显示)
      - [检查公开追踪器是否正常获取](#检查公开追踪器是否正常获取)
      - [检查默认下载位置以及下载模式](#检查默认下载位置以及下载模式)
    - [配置NZBGet服务器](#配置nzbget服务器)
      - [输入Usenet Provider域名，端口号，用户名以及密码等信息。](#输入usenet-provider域名端口号用户名以及密码等信息)
      - [检查分类是否正确](#检查分类是否正确)
      - [检查下载位置是否正确](#检查下载位置是否正确)
      - [检查程序缓存以及最大下载队列是否正确](#检查程序缓存以及最大下载队列是否正确)
      - [`TLS1.3`测试结果](#tls13测试结果)
      - [开启`DirectUnpack`提升下载效率](#开启directunpack提升下载效率)
      - [检查重试次数](#检查重试次数)
    - [检查Rsshub配置](#检查rsshub配置)
    - [配置XRAY透明代理加系统代理](#配置xray透明代理加系统代理)
      - [参考systemd配置](#参考systemd配置)
      - [iptables配置](#iptables配置)
      - [安装ipset](#安装ipset)
      - [新增内网ip段](#新增内网ip段)
      - [新增中国大陆ip段](#新增中国大陆ip段)
      - [IPv4配置](#ipv4配置)
      - [IPv6配置（可选项）](#ipv6配置可选项)
      - [查看iptables情况](#查看iptables情况)
      - [持久化ipset以及iptables](#持久化ipset以及iptables)
      - [手动保存`iptables`](#手动保存iptables)
      - [Xray配置](#xray配置)
      - [启动XRAY](#启动xray)
      - [设置DNS域名为：`1.1.1.1`以及：`1.0.0.1`](#设置dns域名为1111以及1001)
      - [设置系统代理](#设置系统代理)
      - [测试透明代理是否成功](#测试透明代理是否成功)
    - [配置Overture以实现DNS国内分流](#配置overture以实现dns国内分流)
      - [安装Overture](#安装overture)
      - [主配置文件`/etc/overture/config.yml`](#主配置文件etcovertureconfigyml)
      - [启用分流](#启用分流)
      - [锁定配置，防止重启失效](#锁定配置防止重启失效)
      - [测试是否成功](#测试是否成功)
    - [设置CPU策略为最佳性能](#设置cpu策略为最佳性能)
      - [查看当前策略](#查看当前策略)
      - [设置开机启动](#设置开机启动)
      - [使配置生效](#使配置生效-1)
    - [挂载SSD并设置写入缓存](#挂载ssd并设置写入缓存)
      - [新增挂载点](#新增挂载点)
      - [查看硬件信息，记下`/dev/sda`](#查看硬件信息记下devsda)
      - [新增分区](#新增分区)
      - [选择`gpt`](#选择gpt)
      - [使用`Ext4`文件系统格式化](#使用ext4文件系统格式化)
      - [获取硬件`UUID`](#获取硬件uuid)
      - [修改`/etc/fstab`，新增以下内容](#修改etcfstab新增以下内容)
      - [挂载SSD至挂载点](#挂载ssd至挂载点)
      - [查看挂载是否成功](#查看挂载是否成功)
      - [qBittorrent配置](#qbittorrent配置)
      - [NZBGet配置](#nzbget配置)
    - [最大化可用空间](#最大化可用空间)
      - [取消预留空间](#取消预留空间)
    - [开启BBR提升网络质量](#开启bbr提升网络质量)
    - [修改最大开启文件数上限](#修改最大开启文件数上限)
    - [绑定DHCP内网地址](#绑定dhcp内网地址)
    - [开启Upnp/DMZ](#开启upnpdmz)
    - [开启Emby硬解](#开启emby硬解)
    - [安装可能缺少的固件](#安装可能缺少的固件)
    - [最大化网卡RX/TX缓冲](#最大化网卡rxtx缓冲)
  - [推荐的安卓客户端](#推荐的安卓客户端)

## 前言

首先，为什么我需要影音系统？

可以想象这样一个场景：

> 打开一个网页，点开搜索框输入想看的电影/电视剧/音乐/书籍，点一个按钮，过几分钟对应的高清资源已经呈现在你的Emby影视库中，刮削完毕，字幕配好，你什么都不需要干，只需要找个舒服的地方开开心心地享受就行。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627014710.png)

**大体思路：** 流程如上图，左上角是输入端，用户经由`Overserr`/`Ombi`来记录下想看的电影/电视剧，`Overserr`/`Ombi`作为整套系统的前端，会自动将请求录入`Radarr`/`Sonarr`。资源录入后，`Radarr`/`Sonarr`作为中间站，会从Indexer -- `Jackett`/`Prowlarr`搜索对应的资源，然后将下载任务推送到下载器 -- `qBittorrent`/`nzbget`。待下载器下载对应的资源后，`Radarr`/`Sonarr`会自动生成硬连接，刮削好nfo，并通知观影前端 -- `Emby`/`Plex`资源已经就绪，于此同时，字幕自动下载工具 -- `Bazarr`/`Chinesesubfinder`会自动扫描目录，并下载好对应的字幕。

通过上述流程可以快速实现观影、追剧、刮削、字幕，下载全部自动化。

本篇文章就教你如何在VPS或NAS上实现这一整套流程以及这一切的背后究竟是怎么实现的。

## TL;DR

1. Emby负责影片的播放，刮削
2. Ombi是一个搜索前端
3. Sonarr,Radarr,Lidarr,Readarr负责资源的请求和整理
4. Prowlarr/Jackett负责indexers的管理和维护
5. Bazarr/Chinesesubfinder负责字幕的获取，整理，升级和维护
6. qBittorrent和NZBget负责资源的实际下载工作

## 硬件需求

- 最低：
    - CPU: 2 Cores 2 Threads
    - Ram: 4 GB
    - Storage: 200 GB

- 建议：
    - CPU: 4 Cores 8 Threads
    - Ram: 8 GB
    - Storage: 10 TB

## 资源获取

那么，首先最重要的问题：我们要怎么获取这些影视资源呢？

摆在我们面前的有三条道路：BT/PT/Usenet，条条道路通罗马。

1. BT:

    相信大部分人对BT并不陌生，相较于中心化的下载服务器，BT利用P2P（Peer-to-Peer）技术，使每个在P2P网络中的用户都成为了资源的提供方；而资源则以分块的形式，散落在每个人的硬盘中，除非拿到种子文件，否则任何人都不（太）可能从网络中拿到完整的文件。正是这些特性，使得BT自一发布就流行至今。本文中使用的`qBittorrent`即是一款BT下载器，另外比较常用的还有`Transmission`/`Deluge`/`uTorrent`/`aria2`等。

    - 优势：
        - 新内容多且下载速度快
        - 无入门门槛，免费
    - 劣势：
        - 旧内容（一般指大于3个月）下载速度相当慢
        - 国内有迅雷吸血的问题（我用qbt加强版解决此问题）
        - 需要公网IP以实现最大下载上传速度 **必须** 

1. PT:

    PT（Private Tracker）在技术与BT并无本质不同，唯一的区别是，BT连接的是公开的Tracker，而PT通常需要邀请注册，并且用自己密钥才能连上Tracker。PT相比BT，入门有一定的门槛，高质量的站点要么只通过熟人间口口相传，要么需要捐赠注册，价格从几十到几百不等。拥有帐号后还需要一定的设备和动手能力来保持帐号的活跃。新入门PT建议从`PT吧`或者`Reddit`起步，从开放注册的PT站点或者有人大量发放的新手站点玩起，慢慢熟悉规则，再逐步进入更好的站点。

    **后续我的朋友圈会不定时分享一些可注册的PT资源站**

    - 优势：
        - 不论新旧下载速度都相当不错
        - 没有迅雷吸血的问题
    - 劣势：
        - 资源数量及质量取决于PT站本身
        - 有入门门槛且需要一定技术知识 **（尤其是那个新站门户任务）** 80%的用户卡在这了
        - 需要公网IP以实现最大下载上传速度 **必须** 

3. Usenet：

    Usenet是早期的一种互联网形式，它甚至比现在的互联网`www`更早。在早期的语境中，Usenet一般指`新闻组`，类似于BBS论坛。在本文中提到的Usenet，指的是利用Usenet网络，存储和分发大容量二进制内容（即各种影视资源）的特性。
    相对于BT资源的良莠不齐，PT的高不可攀，Usenet兼具高质量资源和低门槛（有不少人不间断地从topsite/PT下载资源上传到Usenet），你只要有钱就行，并且也不是很多钱（大约$40+/年），同时还不需要像PT一样维护帐号活跃/长时间做种。
    事实上，如果仅从影视资源角度，Usenet上的资源比任何一个顶级PT都要多、全，甚至有不少玩PT的人，使用Usenet完全是为了下载上面的资源再上传到PT上去；Usenet另一大优势是极快的下载速度，不像BT/PT，资源的下载速度严重依赖于做种人数的多少，Usenet的资源存在服务器上，几乎任何时刻你都可以跑满你的大部分带宽。
    想要玩转Usenet，需要以下3个模块共同协作来下载资源：
   - `Indexer`，类似于种子搜索网站，提供下载Usenet资源需要的nzb文件。Indexer有免费的，有收费的，也有类似于PT一样进入门槛很高的，本文不作推荐，新手可以从免费的玩起，熟悉流程后再寻找质量更高的Indexer。
   - `Provider`，负责提供连接Usenet的帐号。Usenet的内容存储是分布式的，但是你需要一个Provider才能连上Usenet网络，Provider大部分收费，月付费$3-$5左右，这是使用Usenet最大的花销。
   - nzb下载软件，一般用nzbget即可。

   - 优势：
      - 资源齐全且无论新旧都有极高的下载速度
      - 不需要公网IP
   - 劣势：
      - 没有中文
      - 有入门门槛且付费
      - NZBGet在国内需要配合透明代理使用，有较高的技术门槛

## 利用Prowlarr Jackett和FlareSolverr整合资源方便后续搜索

有了资源还不够，这些资源是零散的，并不利于我们进行搜索。因此我们需要能将这些资源整合起来方便我们查询的软件。于是就有了Prowlarr Jackett以及FlareSolverr。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627021232.png)

> Prowlarr是建立在流行的*arr .net/reactjs基础堆栈上的索引器管理器/代理，可与您的各种PVR应用程序集成。Prowlarr支持Torrent Tracker和Usenet Indexer的管理。 它与Lidarr、Mylar3、Radarr、Readarr和Sonarr无缝集成，提供对您的索引器的完整管理，无需为每个应用程序设置索引器（我们全部完成）。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627021427.png)

> Jackett充当代理服务器：它将来自应用程序（Sonarr、Radarr、SickRage、CouchPotato、Mylar3、Lidarr、DuckieTV、qBittorrent、Nefarious等）的查询转换为特定于跟踪器站点的http查询，解析html或json响应，以及 然后将结果发送回请求软件。 这允许获取最近的上传（如RSS）和执行搜索。Jackett是维护索引器抓取和翻译逻辑的单一存储库 - 消除了其他应用程序的负担。

Prowlarr相当于Jackett的升级版，不仅可以让我们进行手动搜索，也可以全自动化地将配置同步给Sonarr Radarr Lidarr Readarr，省去了使用Jackett时必需手动配置与同步indexers的步骤。

> FlareSolverr用于过CF的5秒盾。

## 利用Sonarr、Radarr、Lidarr和Readarr进行资源分类管理

由于各种资源的分类不同，因此我们需要使用专门的软件去查询专门的分类以实现资源的最大化利用以及效率的最优解。因此这就有了Sonarr用于查询并下载电视剧，动画片等有集数的内容；Radarr 电影；Lidarr: 音乐；Readarr：电子书。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627021731.png)

> Sonarr是供Usenet和BitTorrent用户使用的PVR(其实就是一个电视剧管理器)。 它可以监控多个RSS源以获取您最喜欢的节目的新剧集，并全自动化地抓取、排序和重命名它们。它还可以配置为在质量更好的格式可用时自动升级已下载文件的质量。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627021835.png)

> Radarr是Usenet和BitTorrent用户的电影收藏管理器。 它可以监控新电影的多个RSS提要，并将与客户端和索引器交互以全自动化地抓取、排序和重命名它们。它还可以配置为在质量更好的格式可用时自动升级库中现有文件的质量。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627021954.png)

> Lidarr是Usenet和BitTorrent用户的音乐收藏管理器。 它可以监控多个RSS提要以获取您最喜欢的艺术家的新曲目，并全自动化地抓取、排序和重命名它们。它还可以配置为在质量更好的格式可用时自动升级已下载文件的质量。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627022106.png)

> Readarr是Usenet和BitTorrent用户的电子书和有声读物收藏管理器。它可以监控来自您最喜欢的作者的新书的多个RSS提要，并全自动化地抓取、排序和重命名它们。请注意，仅支持给定书籍的一种类型。如果您想要给定书籍的有声读物和电子书，则需要多个实例。

## 利用Ombi来整合Sonarr Radarr和Lidarr的搜索功能

但是作为使用用户，我们并不关心软件的具体分类，因此就有了Ombi来整合Sonarr Radarr以及Lidarr的搜索功能 (暂时不支持Readarr)，让我们可以用一个前端完成所有的搜索工作。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627022252.png)

> Ombi是您友好的媒体请求工具，可自动与您的媒体服务器同步！别担心，它对奶奶很友好。

## 利用qBittorrent(BT/PT)和NZBGet(Usenet)下载资源到本地

当我们确定了需要的内容后，我们就需要软件来从网络中下载需要的资源到本地。因此我们就有了qBittorrent(BT/PT) 以及 NZBGet(Usenet)。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627022458.png)

> qBittorrent是一个用C++/Qt编程的bittorrent客户端，它使用Arvid Norberg的libtorrent（有时称为libtorrent-rasterbar）。它旨在成为所有其他bittorrent客户端的良好替代品。qBittorrent快速、稳定并提供unicode支持以及许多功能。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627022706.png)

> NZBGet是一个二进制下载器，它根据nzb-files中给出的信息从Usenet下载文件。NZBGet是用C++编写的，以其性能和效率而闻名。

## 利用Bazarr和Chinesesubfinder下载字幕

在拿到了需要的资源后，很多时候它们并没有附带我们所需要的字幕，因此我们就需要从网络中下载字幕的软件。于是就有了Bazarr以及Chinesesubfinder。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627023231.png)

> Bazarr是Sonarr和Radarr的配套应用程序。它根据您的要求管理和下载字幕。您可以通过电视节目或电影定义您的偏好，Bazarr会为您处理一切。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627023343.png)

> 本项目的初衷仅仅是想自动化搞定限定条件下中文字幕下载。

## 使用Emby尽情愉快地放飞自我

一切都就绪了，是时候开始享受了。拿瓶快乐水，躺在沙发上，打开Emby。远离现实的嘈杂，开始欣赏属于另一个世界的故事吧！

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627023539.png)

## 流程总结

在让我们换个角度，从我们作为用户的角度出发总结一下发生了什么。

我们在Ombi(或者Sonarr等)中搜索了想要的内容，点击了添加至库存，等了一段时间，哇，Emby里面出现了！是不是很神奇？

## 手动折腾ing

生命在于折腾，折腾是为了躺平，现在让我们开始搭建吧。

> ★★★ 以下案例中所有的代码均可在[这里](https://github.com/johnrosen1/vpstoolbox/tree/master/install)找到并复制黏贴。

本文使用`Debian Linux`操作系统以及`root`用户作为示范。默认用户名为`admin`，密码为`adminadmin`。

### 文件架构

> 所有文件都需要放在同一个/data目录下以启用硬链接，更多内容请看[这里](https://trash-guides.info/Hardlinks/How-to-setup-for/Docker/)

```txt
data
├── torrents
│  ├── Movies
│  ├── Series
│  ├── Music
│  └── Books
│  └── XXX
│  └── Others
├── usenet
│  ├── Movies
│  ├── Series
│  ├── Music
│  └── Books
│  └── XXX
│  └── Others
└── media
   ├── Movies
   ├── Series
   ├── Music
   ├── Books
   ├── XXX
   └── Others
```

### 新建文件夹

```sh
## 一级子目录(sonarr,radarr,lidarr,readarr Docker卷)
mkdir /data/
## 二级子目录(qbt,emby,bazarr Docker卷)
mkdir /data/torrents/
mkdir /data/usenet/
mkdir /data/media/
## BT/PT qBittorrent 下载位置
mkdir /data/torrents/Movies/
mkdir /data/torrents/Series/
mkdir /data/torrents/Music/
mkdir /data/torrents/Books/
mkdir /data/torrents/XXX/
mkdir /data/torrents/Others/
## Usenet NZBGet 下载位置
mkdir /data/usenet/Movies/
mkdir /data/usenet/Series/
mkdir /data/usenet/Music/
mkdir /data/usenet/Books/
mkdir /data/usenet/XXX/
mkdir /data/usenet/Others/
## Sonarr Radarr Lidarr Readarr Rootfolder
mkdir /data/media/Movies/
mkdir /data/media/Series/
mkdir /data/media/Music/
mkdir /data/media/Books/
mkdir /data/media/XXX/
mkdir /data/media/Others/

## 安装后面配置需要的软件

apt-get install xml-twig-tools lsb-release unzip sqlite3 jq sudo -y

## 新建软件配置文件夹

mkdir /usr/share/nginx/nzbget
mkdir /usr/share/nginx/nzbget/config
mkdir /usr/share/nginx/sonarr
mkdir /usr/share/nginx/sonarr/config
mkdir /usr/share/nginx/radarr
mkdir /usr/share/nginx/radarr/config
mkdir /usr/share/nginx/lidarr
mkdir /usr/share/nginx/lidarr/config
mkdir /usr/share/nginx/readarr
mkdir /usr/share/nginx/readarr/config
mkdir /usr/share/nginx/prowlarr
mkdir /usr/share/nginx/prowlarr/config
mkdir /usr/share/nginx/jackett
mkdir /usr/share/nginx/jackett/config
mkdir /usr/share/nginx/bazarr
mkdir /usr/share/nginx/bazarr/config
mkdir /usr/share/nginx/chinesesubfinder
mkdir /usr/share/nginx/chinesesubfinder/app/
mkdir /usr/share/nginx/chinesesubfinder/app/cache
mkdir /usr/share/nginx/chinesesubfinder/config
mkdir /usr/share/nginx/ombi
mkdir /usr/share/nginx/ombi/config

# DDNS 专用
mkdir /usr/share/nginx/ddclient
```

### Nginx

因为没有人会想去记各个应用的端口号，因此我们需要安装Nginx并配置子目录以及反向代理。

#### 安装Nginx

```sh
apt-get update
apt-get install ca-certificates lsb-release -y
apt-get install gnupg2 -y
touch /etc/apt/sources.list.d/nginx.list
  cat > '/etc/apt/sources.list.d/nginx.list' << EOF
deb https://nginx.org/packages/mainline/debian/ $(lsb_release -cs) nginx
EOF
  curl -fsSL https://nginx.org/keys/nginx_signing.key | apt-key add -
  apt-get update
  apt-get install nginx -y
  cat > '/lib/systemd/system/nginx.service' << EOF
[Unit]
Description=The NGINX HTTP and reverse proxy server
Before=netdata.service trojan.service
After=syslog.target network.target remote-fs.target nss-lookup.target

[Service]
Type=forking
PIDFile=/run/nginx.pid
ExecStartPre=/usr/sbin/nginx -t
ExecStart=/usr/sbin/nginx
ExecReload=/usr/sbin/nginx -s reload
ExecStop=/bin/kill -s QUIT \$MAINPID
PrivateTmp=true
LimitNOFILE=65536
Restart=always
RestartSec=3s

[Install]
WantedBy=multi-user.target
EOF
systemctl daemon-reload
```

#### 配置NGINX主配置文件

```sh
  cat > '/etc/nginx/nginx.conf' << EOF
user nginx;
worker_processes auto;

error_log /var/log/nginx/error.log warn;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;
events {
  worker_connections 65536;
  use epoll;
  multi_accept on;
}

http {

  autoindex_exact_size off;
  http2_push_preload on;
  aio threads;
  charset UTF-8;
  tcp_nodelay on;
  tcp_nopush on;
  server_tokens off;
  
  proxy_intercept_errors on;
  proxy_http_version 1.1;
  proxy_ssl_protocols TLSv1.2 TLSv1.3;
  proxy_set_header Host \$http_host;
  proxy_set_header X-Real-IP \$remote_addr;
  proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;

  include /etc/nginx/mime.types;
  default_type application/octet-stream;

  access_log /var/log/nginx/access.log;

  log_format  main  '\$remote_addr - \$remote_user [\$time_local] "\$request" '
    '\$status \$body_bytes_sent "\$http_referer" '
    '"\$http_user_agent" "\$http_x_forwarded_for"';

  sendfile on;
  gzip on; # 本地Nas可以考虑把这个关掉节省CPU资源
  gzip_proxied any;
  gzip_types *;
  gzip_comp_level 1;

  include /etc/nginx/conf.d/default.conf;
}
EOF
```

#### 启动Nginx

```sh
systemctl enable nginx --now
```

#### 配置子目录以及反向代理

#### 新建NGINX配置

```sh
rm /etc/nginx/conf.d/*.conf # 删除旧配置
touch /etc/nginx/conf.d/default.conf
```

#### 写入新配置

我个人用不惯自带的`nano`命令，建议操作前先安装一下`vi&vim`

```sh
sudo apt-get install vim
```

```sh
vim /etc/nginx/conf.d/default.conf
```

```sh
server {
  listen 80 fastopen=20 reuseport default_server so_keepalive=on;
  server_name _;
  location / {
    root /usr/share/nginx/html/;
  }
    location /qbt/ {
        #access_log off;
        proxy_pass              http://127.0.0.1:8080/;
        client_max_body_size 0;
        proxy_set_header        X-Forwarded-Host        $http_host;
        }
    location /emby/ {
        #access_log off;
        proxy_pass http://127.0.0.1:8096/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        proxy_buffering off;
        }
    location /sonarr/ {
        #access_log off;
        proxy_pass http://127.0.0.1:8989/sonarr/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        #proxy_buffering off;
        }
    location /radarr/ {
        #access_log off;
        proxy_pass http://127.0.0.1:7878/radarr/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        #proxy_buffering off;
        }
    location /lidarr/ {
        #access_log off;
        proxy_pass http://127.0.0.1:8686/lidarr/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        #proxy_buffering off;
        }
    location /readarr/ {
        #access_log off;
        proxy_pass http://127.0.0.1:8787/readarr/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        #proxy_buffering off;
        }
    location /bazarr/ {
        #access_log off;
        proxy_pass http://127.0.0.1:6767/bazarr/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        #proxy_buffering off;
        }
    location /chinesesubfinder/ {
        #access_log off;
        proxy_pass http://127.0.0.1:19035/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        #proxy_buffering off;
        }
    location /prowlarr/ {
        #access_log off;
        proxy_pass http://127.0.0.1:9696/prowlarr/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        #proxy_buffering off;
        }
    location /jackett/ {
        #access_log off;
        proxy_pass http://127.0.0.1:9117/jackett/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        #proxy_buffering off;
        }
    location /ombi/ {
        #access_log off;
        proxy_pass http://127.0.0.1:3579/ombi/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        #proxy_buffering off;
        }
    location /nzbget/ {
        #access_log off;
        client_max_body_size 0;
        proxy_pass http://127.0.0.1:6789/;
        proxy_pass_request_headers on;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $http_host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $http_connection;
        #proxy_buffering off;
        }
    location /rsshub/ {
        proxy_redirect off;
        proxy_pass http://127.0.0.1:1200/;
        }
}
```

#### 修改NGINX默认前端页面以方便进入

```sh
vim /usr/share/nginx/html/index.html
```

#### 写入以下配置

> 更新：新增Resilio Sync配置。

```html
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<h2>前端</h2>
<a href="http://10.0.0.1:80/emby/" target="_blank" rel="noreferrer">Emby</a>
<a href="http://10.0.0.1:80/ombi/" target="_blank" rel="noreferrer">Ombi</a>
<a href="http://10.0.0.1:8888" target="_blank" rel="noreferrer">Resilio-sync</a>
<h2>中间层</h2>
<a href="http://10.0.0.1:80/sonarr/" target="_blank" rel="noreferrer">Sonarr</a>
<a href="http://10.0.0.1:80/radarr/" target="_blank" rel="noreferrer">Radarr</a>
<a href="http://10.0.0.1:80/lidarr/" target="_blank" rel="noreferrer">Lidarr</a>
<a href="http://10.0.0.1:80/readarr/" target="_blank" rel="noreferrer">Readarr</a>
<h2>字幕</h2>
<a href="http://10.0.0.1:80/bazarr/" target="_blank" rel="noreferrer">Bazarr</a>
<a href="http://10.0.0.1:80/chinesesubfinder/" target="_blank" rel="noreferrer">Chinesesubfinder</a>
<h2>索引器</h2>
<a href="http://10.0.0.1:80/prowlarr/" target="_blank" rel="noreferrer">Prowlarr</a>
<a href="http://10.0.0.1:80/jackett/" target="_blank" rel="noreferrer">Jackett</a>
<a href="http://10.0.0.1:80/rsshub/" target="_blank" rel="noreferrer">Rsshub</a>
<h2>下载器</h2>
<a href="http://10.0.0.1:80/qbt/" target="_blank" rel="noreferrer">Qbittorrent</a>
<a href="http://10.0.0.1:80/nzbget/" target="_blank" rel="noreferrer">Nzbget</a>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>
```

`10.0.0.1`替换成你自己**Nas/VPS的IP**，效果图如下

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627024726.png)

#### 使配置生效

```sh
nginx -t && nginx -s reload
```

！！！VPS请记得去自行配置SSL证书并修改NGINX配置。

### Docker

#### 安装Docker

```sh
apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common -y
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
#apt-key fingerprint 0EBFCD88
add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian $(lsb_release -cs) stable"
apt-get update
apt-get install docker-ce docker-ce-cli containerd.io -y
```

#### 安装Docker-compose

```sh
dockerver=$(curl --retry 5 -s "https://api.github.com/repos/docker/compose/releases/latest" | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/') # 获取最新版Docker-compose
sudo curl --retry 5 -L "https://github.com/docker/compose/releases/download/${dockerver}/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### Emby

#### 安装Emby(新版本需要修改下方命令链接)

```sh
apt install -y apt-transport-https
curl --retry 5 -LO https://github.com/MediaBrowser/Emby.Releases/releases/download/4.7.0.32/emby-server-deb_4.7.0.32_amd64.deb
dpkg -i emby-server*.deb
rm emby-server-*.deb
```

### qBittorrent

#### 安装qBittorrent加强版

> 有些PT站可能指名不得使用这个版本，如遇此情况，请用原版。

```sh
mkdir /root/qbt
cd /root/qbt
qbtver=$(curl --retry 5 -s "https://api.github.com/repos/c0re100/qBittorrent-Enhanced-Edition/releases/latest" | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/')
curl --retry 5 -LO https://github.com/c0re100/qBittorrent-Enhanced-Edition/releases/download/${qbtver}/qbittorrent-enhanced-nox_x86_64-linux-musl_static.zip
unzip -o qb*.zip
rm qb*.zip
cp -f qb* /usr/bin/
chmod +x /usr/bin/qbittorrent-nox
cd /root
rm -rf /root/qbt
  cat > '/etc/systemd/system/qbittorrent.service' << EOF
[Unit]
Description=qBittorrent Daemon Service
Documentation=https://github.com/c0re100/qBittorrent-Enhanced-Edition
Wants=network-online.target
After=network-online.target nss-lookup.target

[Service]
Type=simple
User=root
RemainAfterExit=yes
ExecStart=/usr/bin/qbittorrent-nox --profile=/usr/share/nginx/
TimeoutStopSec=infinity
LimitNOFILE=65536
Restart=always
RestartSec=3s

[Install]
WantedBy=multi-user.target
EOF
systemctl daemon-reload
systemctl enable qbittorrent.service
```

#### 下载mmdb这样peer的国旗才会显示

```sh
mkdir /usr/share/nginx/qBittorrent/
mkdir /usr/share/nginx/qBittorrent/data/
mkdir /usr/share/nginx/qBittorrent/data/GeoIP/
cd /usr/share/nginx/qBittorrent/data/GeoIP/
curl -LO --progress-bar https://raw.githubusercontent.com/johnrosen1/vpstoolbox/master/binary/GeoLite2-Country.mmdb
systemctl restart qbittorrent
```

#### 修改性能设置

```sh
cpu_thread_count=$(nproc --all)
io_thread=$((${cpu_thread_count}*4))

qbtcookie=$(curl -i --header 'Referer: http://127.0.0.1:8080' --data 'username=admin&password=adminadmin' http://127.0.0.1:8080/api/v2/auth/login | grep -i set-cookie | cut -c13-48) # adminadmin 为 webui 默认密码

curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22auto_delete_mode%22:1%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22async_io_threads%22:${io_thread}%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22preallocate_all%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22customize_trackers_list_url%22:%22https:%2f%2ftrackerslist.com%2fall.txt%22%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22auto_update_trackers_enabled%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22idn_support_enabled%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22enable_multi_connections_from_same_ip%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22add_trackers_enabled%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22announce_to_all_tiers%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22announce_to_all_trackers%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22announce_to_all_trackers%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22limit_utp_rate%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22limit_tcp_overhead%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22limit_lan_peers%22:false%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22enable_os_cache%22:false%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22alternative_webui_enabled%22:false%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22web_ui_upnp%22:false%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22alternative_webui_path%22:%22%2fusr%2fshare%2fnginx%2fqBittorrent%2fweb%2f%22%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22max_connec%22:-1%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22max_connec_per_torrent%22:-1%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22web_ui_address%22:%22127.0.0.1%22%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22validate_https_tracker_certificate%22:false%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22peer_tos%22:0%7D  --cookie "${qbtcookie}"
## 设置自动管理以及默认下载位置
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22auto_tmm_enabled%22:true%7D  --cookie "${qbtcookie}"
curl http://127.0.0.1:8080/api/v2/app/setPreferences?json=%7B%22save_path%22:%22%2fdata%2fmedia%2f%22%7D --cookie "${qbtcookie}"
```

#### 新增分类及对应的下载位置

```sh
curl -X POST -F 'category=Series' -F 'savePath=/data/torrents/Series/' http://127.0.0.1:8080/api/v2/torrents/createCategory --cookie "${qbtcookie}"
curl -X POST -F 'category=Movies' -F 'savePath=/data/torrents/Movies/' http://127.0.0.1:8080/api/v2/torrents/createCategory --cookie "${qbtcookie}"
curl -X POST -F 'category=Music' -F 'savePath=/data/torrents/Music/' http://127.0.0.1:8080/api/v2/torrents/createCategory --cookie "${qbtcookie}"
curl -X POST -F 'category=Bookes' -F 'savePath=/data/torrents/Books/' http://127.0.0.1:8080/api/v2/torrents/createCategory --cookie "${qbtcookie}"
curl -X POST -F 'category=XXX' -F 'savePath=/data/torrents/XXX/' http://127.0.0.1:8080/api/v2/torrents/createCategory --cookie "${qbtcookie}"
curl -X POST -F 'category=Others' -F 'savePath=/data/torrents/Others/' http://127.0.0.1:8080/api/v2/torrents/createCategory --cookie "${qbtcookie}"
```

### Docker-compose配置文件及命令行配置

命令行配置是为了解决我作为用户每次都要去网页上手动配置的痛点而开发的。使用Docker-compose主要是为了方便部署，更新与维护。

> Rsshub为可选项，主要用于爬取不提供RSS/API的网站。

> 更新：`ddclient`内容、`Autoheal`用于全自动重启掉线容器、`Resilio Sync`可选项、由于官方版本的NZBGet不支援`TLS1.3`，所以构建了一个独立的[Docker image](https://hub.docker.com/r/johnrosen/nzbget)以支援`TLS1.3`。

#### 写入Docker-compose配置文件

```sh
cd /data/ # 放在同一个目录下方便管理
    cat > "docker-compose.yml" << EOF
version: "3.8"
services:
  nzbget:
    # 6789
    network_mode: host
    image: johnrosen/nzbget:latest
    container_name: nzbget
    environment:
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai
    volumes:
      - /usr/share/nginx/nzbget/config:/config
      - /data/usenet:/data/usenet:rw
      - /ssd:/ssd:rw
    restart: always
  sonarr:
    # 8989
    network_mode: host
    image: lscr.io/linuxserver/sonarr
    container_name: sonarr
    environment:
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai
    volumes:
      - /usr/share/nginx/sonarr/config:/config
      - /data:/data
      - /ssd:/ssd
    restart: always
  radarr:
    # 7878
    network_mode: host
    image: lscr.io/linuxserver/radarr
    container_name: radarr
    environment:
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai
    volumes:
      - /usr/share/nginx/radarr/config:/config
      - /data:/data
      - /ssd:/ssd
    restart: always
  lidarr:
    # 8686
    network_mode: host
    image: lscr.io/linuxserver/lidarr
    container_name: lidarr
    environment:
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai
    volumes:
      - /usr/share/nginx/lidarr/config:/config
      - /data:/data
      - /ssd:/ssd
    restart: always
  readarr:
    # 8787
    network_mode: host
    image: lscr.io/linuxserver/readarr:develop
    container_name: readarr
    environment:
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai
    volumes:
      - /usr/share/nginx/readarr/config:/config
      - /data:/data
      - /ssd:/ssd
    restart: always
  prowlarr:
    # 9696
    network_mode: host
    image: lscr.io/linuxserver/prowlarr:develop
    container_name: prowlarr
    environment:
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai
    volumes:
      - /usr/share/nginx/prowlarr/config:/config
    restart: always
  # jackett:
  #   #9117
  #   network_mode: host
  #   image: lscr.io/linuxserver/jackett
  #   container_name: jackett
  #   environment:
  #     - PUID=0
  #     - PGID=0
  #     - TZ=Asia/Shanghai
  #   volumes:
  #     - /usr/share/nginx/jackett/config:/config
  #   restart: always
  flaresolverr:
    # 8191
    network_mode: host
    image: flaresolverr/flaresolverr
    container_name: flaresolverr
    environment:
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - LOG_HTML=${LOG_HTML:-false}
      - CAPTCHA_SOLVER=${CAPTCHA_SOLVER:-none}
      - TZ=Asia/Shanghai
    restart: always
  bazarr:
    # 6767
    network_mode: host
    image: lscr.io/linuxserver/bazarr
    container_name: bazarr
    environment:
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai
    volumes:
      - /usr/share/nginx/bazarr/config:/config
      - /data/media/:/data/media
    restart: always
  chinesesubfinder:
    # 19035
    network_mode: host
    image: allanpk716/chinesesubfinder:latest
    container_name: chinesesubfinder
    environment:
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai
    volumes:
      - /usr/share/nginx/chinesesubfinder/app/cache:/app/cache
      - /usr/share/nginx/chinesesubfinder/config:/config
      - /data:/data
    restart: always
  ombi:
    # 3579
    network_mode: host
    image: lscr.io/linuxserver/ombi
    container_name: ombi
    environment:
      - PUID=0
      - PGID=0
      - TZ=Asia/Shanghai
      - BASE_URL=/ombi
    volumes:
      - /usr/share/nginx/ombi/config:/config
    restart: always
  # resilio-sync:
  #   # 8888
  #   network_mode: host
  #   image: lscr.io/linuxserver/resilio-sync
  #   container_name: resilio-sync
  #   environment:
  #     - PUID=0
  #     - PGID=0
  #     - TZ=Asia/Shanghai
  #   volumes:
  #     - /usr/share/nginx/resilio/config:/config
  #     - /data/resilio/downloads:/data/resilio/downloads
  #     - /data/resilio:/data/resilio
  #     - /ssd:/ssd
  #   restart: always
  # miniflux:
  #   # 8288
  #   image: miniflux/miniflux:latest
  #   container_name: miniflux
  #   restart: always
  #   ports:
  #     - "8288:8080"
  #   depends_on:
  #     - postgresql
  #   environment:
  #     - DATABASE_URL=postgres://miniflux:adminadmin@postgresql/miniflux?sslmode=disable
  #     - RUN_MIGRATIONS=1
  #     - CREATE_ADMIN=1
  #     - ADMIN_USERNAME=admin
  #     - ADMIN_PASSWORD=adminadmin
  # postgresql:
  #   image: postgres:latest
  #   container_name: postgresql
  #   restart: always
  #   environment:
  #     - POSTGRES_USER=miniflux
  #     - POSTGRES_PASSWORD=adminadmin
  #   volumes:
  #     - miniflux-db:/var/lib/postgresql/data
  #   healthcheck:
  #     test: [ "CMD", "pg_isready", "-U", "miniflux" ]
  #     interval: 10s
  #     start_period: 30s
  # rsshub:
  #   # 1200
  #   network_mode: host
  #   image: diygod/rsshub
  #   container_name: rsshub
  #   environment:
  #     # PROXY_URI: 'http://127.0.0.1:8080'
  #     NODE_ENV: production
  #     CACHE_TYPE: redis
  #     REDIS_URL: 'redis://127.0.0.1:6379/'
  #     PUPPETEER_WS_ENDPOINT: 'ws://browserless:3000'
  #   depends_on:
  #     - browserless
  #   restart: always
  # browserless:
  #   # 3000
  #   network_mode: host
  #   image: browserless/chrome
  #   container_name: browserless
  #   restart: always
  # ipfs:
  #   # 4001 5001 8788
  #   network_mode: host
  #   image: ipfs/go-ipfs
  #   container_name: ipfs
  #   restart: always
  #   volumes:
  #     - ipfs_path:/ssd/ipfs
  #     - ipfs_fuse:/ssd/ipfs
  #     - ipns_fuse:/ssd/ipfs/ipns
  #     - /ssd:/ssd
  #   environment:
  #     - IPFS_PATH=/ssd/ipfs
  # photoprism:
  #   # 2342
  #   ports:
  #     - "2342:2342"
  #   image: photoprism/photoprism:latest
  #   container_name: photoprism
  #   depends_on:
  #     - mariadb
  #   restart: always
  #   security_opt:
  #     - seccomp:unconfined
  #     - apparmor:unconfined
  #   environment:
  #     PHOTOPRISM_ADMIN_PASSWORD: "adminadmin" # !!! PLEASE CHANGE YOUR INITIAL "admin" PASSWORD !!!
  #     PHOTOPRISM_SITE_URL: "http://0.0.0.0:2342/" # public server URL incl http:// or https:// and /path, :port is optional
  #     PHOTOPRISM_ORIGINALS_LIMIT: 50 # file size limit for originals in MB (increase for high-res video)
  #     PHOTOPRISM_HTTP_COMPRESSION: "none" # improves transfer speed and bandwidth utilization (none or gzip)
  #     PHOTOPRISM_DEBUG: "false" # run in debug mode (shows additional log messages)
  #     PHOTOPRISM_PUBLIC: "false" # no authentication required (disables password protection)
  #     PHOTOPRISM_READONLY: "false" # don't modify originals directory (reduced functionality)
  #     PHOTOPRISM_EXPERIMENTAL: "false" # enables experimental features
  #     PHOTOPRISM_DISABLE_CHOWN: "false" # disables storage permission updates on startup
  #     PHOTOPRISM_DISABLE_WEBDAV: "false" # disables built-in WebDAV server
  #     PHOTOPRISM_DISABLE_SETTINGS: "false" # disables Settings in Web UI
  #     PHOTOPRISM_DISABLE_TENSORFLOW: "false" # disables all features depending on TensorFlow
  #     PHOTOPRISM_DISABLE_FACES: "false" # disables facial recognition
  #     PHOTOPRISM_DISABLE_CLASSIFICATION: "false" # disables image classification
  #     PHOTOPRISM_DARKTABLE_PRESETS: "false" # enables Darktable presets and disables concurrent RAW conversion
  #     PHOTOPRISM_DETECT_NSFW: "false" # flag photos as private that MAY be offensive (requires TensorFlow)
  #     PHOTOPRISM_UPLOAD_NSFW: "true" # allows uploads that MAY be offensive
  #     PHOTOPRISM_DATABASE_DRIVER: "mysql" # use MariaDB 10.5+ or MySQL 8+ instead of SQLite for improved performance
  #     PHOTOPRISM_DATABASE_SERVER: "mariadb:3306" # MariaDB or MySQL database server (hostname:port)
  #     PHOTOPRISM_DATABASE_NAME: "photoprism" # MariaDB or MySQL database schema name
  #     PHOTOPRISM_DATABASE_USER: "photoprism" # MariaDB or MySQL database user name
  #     PHOTOPRISM_DATABASE_PASSWORD: "adminadmin" # MariaDB or MySQL database user password
  #     PHOTOPRISM_SITE_TITLE: "PhotoPrism"
  #     PHOTOPRISM_SITE_CAPTION: "AI-Powered Photos App"
  #     PHOTOPRISM_SITE_DESCRIPTION: ""
  #     PHOTOPRISM_SITE_AUTHOR: ""
  #     ## Run/install on first startup (options: update, gpu, tensorflow, davfs, nano, clean):
  #     PHOTOPRISM_INIT: "gpu tensorflow"
  #     ## Hardware video transcoding config (optional)
  #     PHOTOPRISM_FFMPEG_BUFFERS: "64" # FFmpeg capture buffers (default: 32)
  #     # PHOTOPRISM_FFMPEG_BITRATE: "32"              # FFmpeg encoding bitrate limit in Mbit/s (default: 50)
  #     # PHOTOPRISM_FFMPEG_ENCODER: "h264_v4l2m2m"    # use Video4Linux for AVC transcoding (default: libx264)
  #     PHOTOPRISM_FFMPEG_ENCODER: "h264_qsv" # use Intel Quick Sync Video for AVC transcoding (default: libx264)
  #     HOME: "/photoprism"
  #   devices:
  #     - "/dev/dri:/dev/dri"
  #   working_dir: "/photoprism"
  #   volumes:
  #     - "/data:/photoprism/originals"
  #     - "/ssd/photoprism:/photoprism/storage"
  # mariadb:
  #   restart: always
  #   image: mariadb:latest
  #   container_name: mariadb
  #   security_opt:
  #     - seccomp:unconfined
  #     - apparmor:unconfined
  #   command: mysqld --innodb-buffer-pool-size=1G --transaction-isolation=READ-COMMITTED --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci --max-connections=512 --innodb-rollback-on-timeout=OFF --innodb-lock-wait-timeout=120
  #   volumes:
  #     - "/ssd/mariadb:/var/lib/mysql"
  #   environment:
  #     MYSQL_ROOT_PASSWORD: adminadmin
  #     MYSQL_DATABASE: photoprism
  #     MYSQL_USER: photoprism
  #     MYSQL_PASSWORD: adminadmin
  alist:
    # 5244
    network_mode: host
    image: xhofe/alist:latest
    container_name: alist
    restart: always
    devices:
      - "/dev/dri:/dev/dri"
    volumes:
      - /etc/alist:/opt/alist/data
      - /onedrive:/onedrive
      - /ssd:/ssd
  # ddclient:
  #   image: lscr.io/linuxserver/ddclient
  #   container_name: ddclient
  #   environment:
  #     - PUID=0
  #     - PGID=0
  #     - TZ=Asia/Shanghai
  #   volumes:
  #     - /usr/share/nginx/ddclient:/config
  #   restart: always
  # dashy:
  #   image: lissy93/dashy
  #   container_name: Dashy
  #   volumes:
  #     - /root/.config/dashy/conf.yml:/app/public/conf.yml
  #   ports:
  #     - 4000:80
  #   environment:
  #     - NODE_ENV=production
  #     - UID=0
  #     - GID=0
  #   restart: always
  #   healthcheck:
  #     test: [ 'CMD', 'node', '/app/services/healthcheck' ]
  #     interval: 1m30s
  #     timeout: 10s
  #     retries: 3
  #     start_period: 40s
  # uptime-kuma:
    # image: louislam/uptime-kuma:latest
    # container_name: uptime-kuma
    # volumes:
    #   - /usr/share/nginx/uptime:/app/data
    # ports:
    #  - 3001:3001
    # environment:
    #   - UPTIME_KUMA_CLOUDFLARED_TOKEN=
    # restart: always
  autoheal:
    image: willfarrell/autoheal
    container_name: autoheal
    restart: always
    environment:
      - AUTOHEAL_CONTAINER_LABEL=all
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    environment:
      - TZ=Asia/Shanghai
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: --cleanup --schedule "0 0 3 * * *"
    restart: always
volumes:
  miniflux-db:
  ipfs_path:
  ipfs_fuse:
  ipns_fuse:

EOF
```

> 我不想管烦人的权限问题，所以全部用root(PUID=0)运行。

> Docker watchtower用于全自动化地更新所有Docker image。

#### 拉取Docker images并等待60秒让程序初始化。

```sh
docker-compose up -d && sleep 60s
```

#### 关闭所有程序进行配置

```sh
docker-compose down
```

### 配置 NZBGet

> 更新：修改NZBGet可用下载队列为最大值；新增程序写入缓存配置、修正`Server1.Cpiher`，更换`SSLv3`协议为`TLS1.2`。

```sh
# 修改下载位置
sed -i "s/MainDir=\/downloads/MainDir=\/data\/usenet\//g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/DestDir=\${MainDir}\/completed/DestDir=\${MainDir}/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/ControlIP=0.0.0.0/ControlIP=127.0.0.1/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/ControlUsername=nzbget/ControlUsername=admin/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/FormAuth=no/FormAuth=yes/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/AuthorizedIP=127.0.0.1/AuthorizedIP=/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/ControlPassword=tegbzn6789/ControlPassword=${password1}/g" /usr/share/nginx/nzbget/config/nzbget.conf
# 修改Usenet Server相关信息
sed -i "s/Server1.Port=119/Server1.Port=563/g" /usr/share/nginx/nzbget/config/nzbget.conf
# 已更新为 TLS1.2
sed -i "s/Server1.Cipher=/Server1.Cipher=ECDHE-ECDSA-AES128-GCM-SHA256/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/Server1.Encryption=no/Server1.Encryption=yes/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/Server1.Connections=4/Server1.Connections=50/g" /usr/share/nginx/nzbget/config/nzbget.conf
# 单文件连接数上限，建议为 1。
sed -i "s/UrlConnections=4/UrlConnections=1/g" /usr/share/nginx/nzbget/config/nzbget.conf
# 新增分类
sed -i "s/Category4.Name=Software/Category4.Name=Books/g" /usr/share/nginx/nzbget/config/nzbget.conf 
sed -i '/^Category4.Name=Books/a Category5.Name=XXX' /usr/share/nginx/nzbget/config/nzbget.conf
sed -i '/^Category5.Name=XXX/a Category6.Name=Others' /usr/share/nginx/nzbget/config/nzbget.conf
# 修改可用下载队列为最大值。
sed -i "s/PostStrategy=sequential/PostStrategy=rocket/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/PostStrategy=balanced/PostStrategy=rocket/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/PostStrategy=aggressive/PostStrategy=rocket/g" /usr/share/nginx/nzbget/config/nzbget.conf
# 提升下载效率
sed -i "s/DirectUnpack=no/DirectUnpack=yes/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/DirectRename=no/DirectRename=yes/g" /usr/share/nginx/nzbget/config/nzbget.conf
# 修改写入缓存大小（程序缓存）
sed -i "s/ArticleCache=0/ArticleCache=200/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/WriteBuffer=0/WriteBuffer=1024/g" /usr/share/nginx/nzbget/config/nzbget.conf
# 修改重试次数
sed -i "s/ArticleRetries=3/ArticleRetries=99/g" /usr/share/nginx/nzbget/config/nzbget.conf
sed -i "s/UrlRetries=3/UrlRetries=99/g" /usr/share/nginx/nzbget/config/nzbget.conf
```

### 配置Sonarr

> 配置项目及内容大同小异，因此雷同注释仅标注一次。

> 更新：重命名规则请照抄[这个教程](https://trash-guides.info/Sonarr/)

```sh
# 修改baseurl
sed -i "s/<UrlBase><\/UrlBase>/<UrlBase>\/sonarr\/<\/UrlBase>/g" /usr/share/nginx/sonarr/config/config.xml 
sed -i '$d' /usr/share/nginx/sonarr/config/config.xml
# 关闭信息收集
echo '  <AnalyticsEnabled>False</AnalyticsEnabled>' >> /usr/share/nginx/sonarr/config/config.xml 
echo '</Config>' >> /usr/share/nginx/sonarr/config/config.xml
# 新增根目录
sqlite3 /usr/share/nginx/sonarr/config/sonarr.db  "insert into RootFolders values ('1','/data/media/Series/');"
# 开启刮削

> 2022.6.25 更新：此处不建议开启，刮削结果为英文，建议将该工作交由 Emby 完成。

sqlite3 /usr/share/nginx/sonarr/config/sonarr.db  "DELETE FROM Metadata WHERE Id = 1;"
sqlite3 /usr/share/nginx/sonarr/config/sonarr.db  "insert into Metadata values ('1','1','Kodi (XBMC) / Emby','XbmcMetadata','{
  \"seriesMetadata\": true,
  \"seriesMetadataUrl\": false,
  \"episodeMetadata\": true,
  \"seriesImages\": true,
  \"seasonImages\": true,
  \"episodeImages\": true,
  \"isValid\": true
}','XbmcMetadataSettings');"
# 修改语言为简体中文，繁体中文以及英文
sqlite3 /usr/share/nginx/sonarr/config/sonarr.db  "DELETE FROM LanguageProfiles WHERE Id = 1;"
sqlite3 /usr/share/nginx/sonarr/config/sonarr.db  "insert into LanguageProfiles values ('1','Chinese','[
  {
    \"language\": 0,
    \"allowed\": false
  },
  {
    \"language\": 13,
    \"allowed\": false
  },
  {
    \"language\": 17,
    \"allowed\": false
  },
  {
    \"language\": 14,
    \"allowed\": false
  },
  {
    \"language\": 3,
    \"allowed\": false
  },
  {
    \"language\": 11,
    \"allowed\": false
  },
  {
    \"language\": 18,
    \"allowed\": false
  },
  {
    \"language\": 12,
    \"allowed\": false
  },
  {
    \"language\": 15,
    \"allowed\": false
  },
  {
    \"language\": 24,
    \"allowed\": false
  },
  {
    \"language\": 21,
    \"allowed\": false
  },
  {
    \"language\": 5,
    \"allowed\": false
  },
  {
    \"language\": 9,
    \"allowed\": false
  },
  {
    \"language\": 22,
    \"allowed\": false
  },
  {
    \"language\": 27,
    \"allowed\": false
  },
  {
    \"language\": 23,
    \"allowed\": false
  },
  {
    \"language\": 20,
    \"allowed\": false
  },
  {
    \"language\": 4,
    \"allowed\": false
  },
  {
    \"language\": 2,
    \"allowed\": false
  },
  {
    \"language\": 19,
    \"allowed\": false
  },
  {
    \"language\": 16,
    \"allowed\": false
  },
  {
    \"language\": 7,
    \"allowed\": false
  },
  {
    \"language\": 6,
    \"allowed\": false
  },
  {
    \"language\": 25,
    \"allowed\": false
  },
  {
    \"language\": 28,
    \"allowed\": false
  },
  {
    \"language\": 26,
    \"allowed\": false
  },
  {
    \"language\": 8,
    \"allowed\": true
  },
  {
    \"language\": 1,
    \"allowed\": true
  },
  {
    \"language\": 10,
    \"allowed\": true
  }
]','10','0');"
# 开启重命名

sqlite3 /usr/share/nginx/sonarr/config/sonarr.db  "DELETE FROM NamingConfig WHERE Id = 1;"
sqlite3 /usr/share/nginx/sonarr/config/sonarr.db  "insert into NamingConfig values ('1','0','1','{Series Title} - S{season:00}E{episode:00} - {Episode Title} {Quality Full}','{Series Title} - {Air-Date} - {Episode Title} {Quality Full}','Season {season}','{Series Title}','{Series Title} - S{season:00}E{episode:00} - {Episode Title} {Quality Full}','1','Specials');"
# 新增qBittorrent 下载客户端
  sqlite3 /usr/share/nginx/sonarr/config/sonarr.db  "insert into DownloadClients values ('1','1','qBittorrent_Series','QBittorrent','{
  \"host\": \"127.0.0.1\",
  \"port\": 8080,
  \"useSsl\": false,
  \"username\": \"admin\",
  \"password\": \"adminadmin\",
  \"tvCategory\": \"Series\",
  \"recentTvPriority\": 0,
  \"olderTvPriority\": 0,
  \"initialState\": 0,
  \"sequentialOrder\": false,
  \"firstAndLast\": false
}','QBittorrentSettings','1','1','1');" 
# 新增NZBGet 下载客户端
  sqlite3 /usr/share/nginx/sonarr/config/sonarr.db  "insert into DownloadClients values ('2','1','NZBGet_Series','Nzbget','{
  \"host\": \"127.0.0.1\",
  \"port\": 6789,
  \"useSsl\": false,
  \"username\": \"admin\",
  \"password\": \"adminadmin\",
  \"tvCategory\": \"Series\",
  \"recentTvPriority\": 0,
  \"olderTvPriority\": 0,
  \"addPaused\": false
}','NzbgetSettings','1','1','1');" 
# 获取Sonarr api,后面要用到
sonarr_api=$(xml_grep 'ApiKey' /usr/share/nginx/sonarr/config/config.xml --text_only) 
```

### 配置Radarr

> 更新：重命名规则请照抄[这个教程](https://trash-guides.info/Sonarr/)

```sh
sed -i "s/<UrlBase><\/UrlBase>/<UrlBase>\/radarr\/<\/UrlBase>/g" /usr/share/nginx/radarr/config/config.xml
sed -i '$d' /usr/share/nginx/radarr/config/config.xml
echo '  <AnalyticsEnabled>False</AnalyticsEnabled>' >> /usr/share/nginx/radarr/config/config.xml
echo '</Config>' >> /usr/share/nginx/radarr/config/config.xml
sqlite3 /usr/share/nginx/radarr/config/radarr.db  "insert into RootFolders values ('1','/data/media/Movies/');"
sqlite3 /usr/share/nginx/radarr/config/radarr.db  "insert into Config values ('6','movieinfolanguage','10');"
sqlite3 /usr/share/nginx/radarr/config/radarr.db  "insert into Config values ('7','uilanguage','10');"
sqlite3 /usr/share/nginx/radarr/config/radarr.db  "UPDATE Metadata SET Enable = 1 WHERE Id = 1;"
sqlite3 /usr/share/nginx/radarr/config/radarr.db  "DELETE FROM Metadata WHERE Id = 1;"
sqlite3 /usr/share/nginx/radarr/config/radarr.db  "insert into Metadata values ('1','1','Kodi (XBMC) / Emby','XbmcMetadata','{
  \"movieMetadata\": true,
  \"movieMetadataURL\": false,
  \"movieMetadataLanguage\": 10,
  \"movieImages\": true,
  \"useMovieNfo\": false,
  \"isValid\": true
}','XbmcMetadataSettings');"
sqlite3 /usr/share/nginx/radarr/config/radarr.db  "DELETE FROM NamingConfig WHERE Id = 1;"
sqlite3 /usr/share/nginx/radarr/config/radarr.db  "insert into NamingConfig values ('1','0','1','{Movie Title} ({Release Year}) {Quality Full}','{Movie Title} ({Release Year})','0','1');"
  sqlite3 /usr/share/nginx/radarr/config/radarr.db  "insert into DownloadClients values ('1','1','qBittorrent','QBittorrent','{
  \"host\": \"127.0.0.1\",
  \"port\": 8080,
  \"useSsl\": false,
  \"username\": \"admin\",
  \"password\": \"adminadmin\",
  \"movieCategory\": \"Movies\",
  \"recentTvPriority\": 0,
  \"olderTvPriority\": 0,
  \"initialState\": 0
}','QBittorrentSettings','1','1','1');"

sqlite3 /usr/share/nginx/radarr/config/radarr.db  "insert into DownloadClients values ('2','1','NZBGet','Nzbget','{
  \"host\": \"127.0.0.1\",
  \"port\": 6789,
  \"useSsl\": false,
  \"username\": \"admin\",
  \"password\": \"adminadmin\",
  \"movieCategory\": \"Movies\",
  \"recentMoviePriority\": 0,
  \"olderMoviePriority\": 0,
  \"addPaused\": false
}','NzbgetSettings','1','1','1');"
radarr_api=$(xml_grep 'ApiKey' /usr/share/nginx/radarr/config/config.xml --text_only)
```

### 配置Lidarr

```sh
sed -i "s/<UrlBase><\/UrlBase>/<UrlBase>\/lidarr\/<\/UrlBase>/g" /usr/share/nginx/lidarr/config/config.xml
sed -i '$d' /usr/share/nginx/lidarr/config/config.xml
echo '  <AnalyticsEnabled>False</AnalyticsEnabled>' >> /usr/share/nginx/lidarr/config/config.xml
echo '</Config>' >> /usr/share/nginx/lidarr/config/config.xml
sqlite3 /usr/share/nginx/lidarr/config/lidarr.db  "insert into RootFolders values ('1','/data/media/Music/','music','1','1','0','[]');"
sqlite3 /usr/share/nginx/lidarr/config/lidarr.db  "DELETE FROM Metadata WHERE Id = 1;"
sqlite3 /usr/share/nginx/lidarr/config/lidarr.db  "insert into Metadata values ('1','1','Kodi (XBMC) / Emby','XbmcMetadata','{
  \"artistMetadata\": true,
  \"albumMetadata\": true,
  \"artistImages\": true,
  \"albumImages\": true,
  \"isValid\": true
}','XbmcMetadataSettings');"
sqlite3 /usr/share/nginx/lidarr/config/lidarr.db  "DELETE FROM NamingConfig WHERE Id = 1;"
sqlite3 /usr/share/nginx/lidarr/config/lidarr.db  "insert into NamingConfig values ('1','1','{Artist Name}','1','{Album Title} ({Release Year})/{Artist Name} - {Album Title} - {track:00} - {Track Title}','{Album Title} ({Release Year})/{Medium Format} {medium:00}/{Artist Name} - {Album Title} - {track:00} - {Track Title}');"
  sqlite3 /usr/share/nginx/lidarr/config/lidarr.db  "insert into DownloadClients values ('1','1','qBittorrent','QBittorrent','{
  \"host\": \"127.0.0.1\",
  \"port\": 8080,
  \"username\": \"admin\",
  \"password\": \"adminadmin\",
  \"musicCategory\": \"Music\",
  \"recentTvPriority\": 0,
  \"olderTvPriority\": 0,
  \"initialState\": 0,
  \"useSsl\": false
}','QBittorrentSettings','1');"

sqlite3 /usr/share/nginx/lidarr/config/lidarr.db  "insert into DownloadClients values ('2','1','NZBGet','Nzbget','{
  \"host\": \"127.0.0.1\",
  \"port\": 6789,
  \"username\": \"admin\",
  \"password\": \"adminadmin\",
  \"musicCategory\": \"Music\",
  \"recentTvPriority\": 0,
  \"olderTvPriority\": 0,
  \"addPaused\": false,
  \"useSsl\": false
}','NzbgetSettings','1');"
lidarr_api=$(xml_grep 'ApiKey' /usr/share/nginx/lidarr/config/config.xml --text_only)
```

### 配置Readarr

```sh
sed -i "s/<UrlBase><\/UrlBase>/<UrlBase>\/readarr\/<\/UrlBase>/g" /usr/share/nginx/readarr/config/config.xml
sed -i '$d' /usr/share/nginx/readarr/config/config.xml
echo '  <AnalyticsEnabled>False</AnalyticsEnabled>' >> /usr/share/nginx/readarr/config/config.xml
echo '</Config>' >> /usr/share/nginx/readarr/config/config.xml
# sqlite3 /usr/share/nginx/readarr/config/readarr.db  "insert into RootFolders values ('1','/data/media/Books/','Books','1','1','0','[]','0','','0');"
sqlite3 /usr/share/nginx/readarr/config/readarr.db  "DELETE FROM NamingConfig WHERE Id = 1;"
sqlite3 /usr/share/nginx/readarr/config/readarr.db  "insert into NamingConfig values ('1','1','{Author Name}','1','{Book Title}/{Author Name} - {Book Title}{ (PartNumber)}');"
sqlite3 /usr/share/nginx/readarr/config/readarr.db  "insert into Config values ('6','uilanguage','10');"
  sqlite3 /usr/share/nginx/readarr/config/readarr.db  "insert into DownloadClients values ('1','1','qBittorrent','QBittorrent','{
  \"host\": \"127.0.0.1\",
  \"port\": 8080,
  \"useSsl\": false,
  \"username\": \"admin\",
  \"password\": \"adminadmin\",
  \"musicCategory\": \"Books\",
  \"recentTvPriority\": 0,
  \"olderTvPriority\": 0,
  \"initialState\": 0
}','QBittorrentSettings','1');"

sqlite3 /usr/share/nginx/readarr/config/readarr.db  "insert into DownloadClients values ('2','1','NZBGet','Nzbget','{
  \"host\": \"127.0.0.1\",
  \"port\": 6789,
  \"useSsl\": false,
  \"username\": \"admin\",
  \"password\": \"adminadmin\",
  \"musicCategory\": \"Books\",
  \"recentTvPriority\": 0,
  \"olderTvPriority\": 0,
  \"addPaused\": false
}','NzbgetSettings','1');"
readarr_api=$(xml_grep 'ApiKey' /usr/share/nginx/readarr/config/config.xml --text_only)
```

### 配置prowlarr

```sh
sed -i "s/<UrlBase><\/UrlBase>/<UrlBase>\/prowlarr\/<\/UrlBase>/g" /usr/share/nginx/prowlarr/config/config.xml
sed -i '$d' /usr/share/nginx/prowlarr/config/config.xml
echo '  <AnalyticsEnabled>False</AnalyticsEnabled>' >> /usr/share/nginx/prowlarr/config/config.xml
echo '</Config>' >> /usr/share/nginx/prowlarr/config/config.xml
# 将prowlarr与Sonarr等链接以实现indexers同步
add_prowlarr_sonarr_radarr_lidarr_readarr(){
    cat > "add1.sh" << "EOF"
#!/usr/bin/env bash
  sqlite3 /usr/share/nginx/prowlarr/config/prowlarr.db  "insert into Applications values ('1','Sonarr','Sonarr','{
  \"prowlarrUrl\": \"http://127.0.0.1:9696\",
  \"baseUrl\": \"http://127.0.0.1:8989/sonarr\",
  \"apiKey\": \"adminadmin\",
  \"syncCategories\": [
    5000,
    5010,
    5020,
    5030,
    5040,
    5045,
    5050
  ],
  \"animeSyncCategories\": [
    5070
  ]
}','SonarrSettings','2','[]');"
EOF
sed -i "s/adminadmin/${sonarr_api}/g" add1.sh
bash add1.sh
rm add1.sh

    cat > "add2.sh" << "EOF"
#!/usr/bin/env bash
  sqlite3 /usr/share/nginx/prowlarr/config/prowlarr.db  "insert into Applications values ('2','Radarr','Radarr','{
  \"prowlarrUrl\": \"http://127.0.0.1:9696\",
  \"baseUrl\": \"http://127.0.0.1:7878/radarr\",
  \"apiKey\": \"adminadmin\",
  \"syncCategories\": [
    2000,
    2010,
    2020,
    2030,
    2040,
    2045,
    2050,
    2060,
    2070,
    2080
  ]
}','RadarrSettings','2','[]');"
EOF
sed -i "s/adminadmin/${radarr_api}/g" add2.sh
bash add2.sh
rm add2.sh

    cat > "add3.sh" << "EOF"
#!/usr/bin/env bash
  sqlite3 /usr/share/nginx/prowlarr/config/prowlarr.db  "insert into Applications values ('3','Lidarr','Lidarr','{
  \"prowlarrUrl\": \"http://127.0.0.1:9696\",
  \"baseUrl\": \"http://127.0.0.1:8686/lidarr\",
  \"apiKey\": \"adminadmin\",
  \"syncCategories\": [
    3000,
    3010,
    3030,
    3040,
    3050,
    3060
  ]
}','LidarrSettings','2','[]');"
EOF
sed -i "s/adminadmin/${lidarr_api}/g" add3.sh
bash add3.sh
rm add3.sh

    cat > "add4.sh" << "EOF"
#!/usr/bin/env bash
  sqlite3 /usr/share/nginx/prowlarr/config/prowlarr.db  "insert into Applications values ('4','Readarr','Readarr','{
  \"prowlarrUrl\": \"http://127.0.0.1:9696\",
  \"baseUrl\": \"http://127.0.0.1:8787/readarr\",
  \"apiKey\": \"adminadmin\",
  \"syncCategories\": [
    3030,
    7000,
    7010,
    7020,
    7030,
    7040,
    7050,
    7060
  ]
}','ReadarrSettings','2','[]');"
EOF
sed -i "s/adminadmin/${readarr_api}/g" add4.sh
bash add4.sh
rm add4.sh
}
add_prowlarr_sonarr_radarr_lidarr_readarr
sqlite3 /usr/share/nginx/prowlarr/config/prowlarr.db  "insert into Tags values ('1','flaresolverr');"
sqlite3 /usr/share/nginx/prowlarr/config/prowlarr.db  "insert into IndexerProxies values ('1','FlareSolverr','{
  \"host\": \"http://127.0.0.1:8191/\",
  \"requestTimeout\": 60
}','FlareSolverr','FlareSolverrSettings','[
  1
]');"
sqlite3 /usr/share/nginx/prowlarr/config/prowlarr.db  "insert into Config values ('6','uilanguage','10');"
  sqlite3 /usr/share/nginx/prowlarr/config/prowlarr.db  "insert into DownloadClients values ('1','1','qBittorrent','QBittorrent','{
  \"host\": \"127.0.0.1\",
  \"port\": 8080,
  \"useSsl\": false,
  \"username\": \"admin\",
  \"password\": \"adminadmin\",
  \"category\": \"Others\",
  \"priority\": 0,
  \"initialState\": 0
}','QBittorrentSettings','1');"

sqlite3 /usr/share/nginx/prowlarr/config/prowlarr.db  "insert into DownloadClients values ('2','1','NZBGet','Nzbget','{
  \"host\": \"127.0.0.1\",
  \"port\": 6789,
  \"useSsl\": false,
  \"username\": \"admin\",
  \"password\": \"adminadmin\",
  \"category\": \"Others\",
  \"priority\": 0,
  \"addPaused\": false
}','NzbgetSettings','1');"
```

### 配置Jackett

```sh
# 配置 BaseUrl
cat '/usr/share/nginx/jackett/config/Jackett/ServerConfig.json' | jq '.BasePathOverride |= "/jackett/"' >> /usr/share/nginx/jackett/config/Jackett/tmp.json
cp -f /usr/share/nginx/jackett/config/Jackett/tmp.json /usr/share/nginx/jackett/config/Jackett/ServerConfig.json
rm /usr/share/nginx/jackett/config/Jackett/tmp.json
# 因为我们用反向代理，所以关掉这个选项不会有事情
cat '/usr/share/nginx/jackett/config/Jackett/ServerConfig.json' | jq '.AllowExternal |= false' >> /usr/share/nginx/jackett/config/Jackett/tmp.json
cp -f /usr/share/nginx/jackett/config/Jackett/tmp.json /usr/share/nginx/jackett/config/Jackett/ServerConfig.json
rm /usr/share/nginx/jackett/config/Jackett/tmp.json
# 配置 FlareSolverr Url
cat '/usr/share/nginx/jackett/config/Jackett/ServerConfig.json' | jq '.FlareSolverrUrl |= "http://127.0.0.1:8191"' >> /usr/share/nginx/jackett/config/Jackett/tmp.json
cp -f /usr/share/nginx/jackett/config/Jackett/tmp.json /usr/share/nginx/jackett/config/Jackett/ServerConfig.json
rm /usr/share/nginx/jackett/config/Jackett/tmp.json
```

### 配置Bazarr

```sh
# 配置 BaseUrl
sed -i "0,/base_url \=/s//base_url \= \/bazarr/g" /usr/share/nginx/bazarr/config/config/config.ini
sed -i '/^\[sonarr\]$/,/^\[/ s/^base_url = \//base_url = \/sonarr\//' /usr/share/nginx/bazarr/config/config/config.ini
# 将Sonarr,Radarr与Bazarr链接
sed -i "/^\[sonarr\]$/,/^\[/ s/^apikey =/apikey = ${sonarr_api}/" /usr/share/nginx/bazarr/config/config/config.ini
sed -i '/^\[radarr\]$/,/^\[/ s/^base_url = \//base_url = \/radarr\//' /usr/share/nginx/bazarr/config/config/config.ini
sed -i "/^\[radarr\]$/,/^\[/ s/^apikey =/apikey = ${radarr_api}/" /usr/share/nginx/bazarr/config/config/config.ini
sed -i '/^\[analytics\]$/,/^\[/ s/^enabled = True/enabled = False/' /usr/share/nginx/bazarr/config/config/config.ini
sed -i "s/use_sonarr = False/use_sonarr = True/g" /usr/share/nginx/bazarr/config/config/config.ini
sed -i "s/use_radarr = False/use_radarr = True/g" /usr/share/nginx/bazarr/config/config/config.ini
sed -i "s/serie_default_enabled = False/serie_default_enabled = True/g" /usr/share/nginx/bazarr/config/config/config.ini
sed -i "s/serie_default_profile =/serie_default_profile = 1/g" /usr/share/nginx/bazarr/config/config/config.ini
sed -i "s/movie_default_enabled = False/movie_default_enabled = True/g" /usr/share/nginx/bazarr/config/config/config.ini
sed -i "s/movie_default_profile =/movie_default_profile = 1/g" /usr/share/nginx/bazarr/config/config/config.ini
sed -i '/^\[assrt\]$/,/^\[/ s/^token =/token = oHwtSNdY1aQe1qwRSZVo70SqNW0Pu1AM/' /usr/share/nginx/bazarr/config/config/config.ini # Assrt站API 5次/分钟
sed -i '/^\[betaseries\]$/,/^\[/ s/^token =/token = ecd1f45f3036/' /usr/share/nginx/bazarr/config/config/config.ini # Betaseries API
# 设置开启的字幕源
sed -i "s/enabled_providers = \[\]/enabled_providers = \['zimuku', 'assrt', 'yifysubtitles', 'betaseries', 'opensubtitlescom', 'supersubtitles', 'tvsubtitles', 'subscenter'\]/g" /usr/share/nginx/bazarr/config/config/config.ini
# 设置字幕语言为简体中文，繁体中文以及英文
sqlite3 /usr/share/nginx/bazarr/config/db/bazarr.db  "insert into table_languages_profiles values ('1','','[{\"id\": 1, \"language\": \"zh\", \"audio_exclude\": \"False\", \"hi\": \"False\", \"forced\": \"False\"}, {\"id\": 2, \"language\": \"zt\", \"audio_exclude\": \"False\", \"hi\": \"False\", \"forced\": \"False\"}, {\"id\": 3, \"language\": \"en\", \"audio_exclude\": \"False\", \"hi\": \"False\", \"forced\": \"False\"}]','Chinese','[]','[]');"
```

### 配置Ombi

```sh
add_sonarr_ombi(){
    cat > "add.sh" << "EOF"
#!/usr/bin/env bash
  sqlite3 /usr/share/nginx/ombi/config/OmbiSettings.db  "insert into GlobalSettings values ('2','{\"Enabled\":true,\"ApiKey\":\"adminadmin\",\"QualityProfile\":\"1\",\"SeasonFolders\":false,\"RootPath\":\"1\",\"QualityProfileAnime\":\"1\",\"RootPathAnime\":\"2\",\"AddOnly\":false,\"V3\":true,\"LanguageProfile\":2,\"LanguageProfileAnime\":2,\"ScanForAvailability\":false,\"Ssl\":false,\"SubDir\":\"/sonarr\",\"Ip\":\"127.0.0.1\",\"Port\":8989,\"Id\":0}','SonarrSettings');"
EOF
sed -i "s/adminadmin/${sonarr_api}/g" add.sh
bash add.sh
rm add.sh
}

add_radarr_ombi(){
    cat > "add.sh" << "EOF"
#!/usr/bin/env bash
  sqlite3 /usr/share/nginx/ombi/config/OmbiSettings.db  "insert into GlobalSettings values ('3','{\"Enabled\":true,\"ApiKey\":\"adminadmin\",\"DefaultQualityProfile\":\"1\",\"DefaultRootPath\":\"/data/media/movies\",\"AddOnly\":false,\"MinimumAvailability\":\"Announced\",\"ScanForAvailability\":false,\"Ssl\":false,\"SubDir\":\"/radarr\",\"Ip\":\"127.0.0.1\",\"Port\":7878,\"Id\":0}','RadarrSettings');"
EOF
sed -i "s/adminadmin/${radarr_api}/g" add.sh
bash add.sh
rm add.sh
}

add_lidarr_ombi(){
    cat > "add.sh" << "EOF"
#!/usr/bin/env bash
  sqlite3 /usr/share/nginx/ombi/config/OmbiSettings.db  "insert into GlobalSettings values ('4','{\"Enabled\":true,\"ApiKey\":\"adminadmin\",\"DefaultQualityProfile\":\"1\",\"DefaultRootPath\":\"/data/media/Music/\",\"AlbumFolder\":true,\"MetadataProfileId\":1,\"AddOnly\":false,\"Ssl\":false,\"SubDir\":\"/lidarr\",\"Ip\":\"127.0.0.1\",\"Port\":8686,\"Id\":0}','LidarrSettings');"
EOF
sed -i "s/adminadmin/${lidarr_api}/g" add.sh
bash add.sh
rm add.sh
}
# 将Sonarr Radarr Lidarr与Ombi链接
add_sonarr_ombi
add_radarr_ombi
add_lidarr_ombi
# 关闭信息收集并设置语言为中文
sqlite3 /usr/share/nginx/ombi/config/OmbiSettings.db  "DELETE FROM GlobalSettings WHERE Id = 1;"
sqlite3 /usr/share/nginx/ombi/config/OmbiSettings.db  "insert into GlobalSettings values ('1','{\"BaseUrl\":\"/ombi\",\"CollectAnalyticData\":false,\"Wizard\":false,\"ApiKey\":\"dfbcab4789604b4289b3cdc71aa41bf6\",\"DoNotSendNotificationsForAutoApprove\":false,\"HideRequestsUsers\":false,\"DisableHealthChecks\":false,\"DefaultLanguageCode\":\"zh\",\"AutoDeleteAvailableRequests\":false,\"AutoDeleteAfterDays\":0,\"Branch\":0,\"HasMigratedOldTvDbData\":false,\"Set\":false,\"Id\":1}','OmbiSettings');"
```

### 启动系统

命令行配置已完成，是时候启动系统进行图形界面配置了。

```sh
cd /data
docker-compose up -d
```

等待几秒钟，然后使用浏览器，访问VPS/NAS的IP/域名，逐一访问页面中的链接，确定都能打开再继续。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627030534.png)

### 配置Emby

#### 打开链接，进行初始化，文件夹路径按照图中设置即可。

> 建议电视节目文件夹将The Movie DB设为首选。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627030638.png)

#### 启用 NFO

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627030719.png)

#### 勾选这个选项

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627030800.png)

#### 新建`电视节目`文件夹

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627030851.png)

#### 新建`电影`文件夹

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627030935.png)

#### 新建`音乐`文件夹

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627031024.png)

#### 新建`书籍`文件夹

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627031116.png)

#### 新建Emby API

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627031255.png)

### 配置Ombi

#### 打开链接，进行初始化，Emby API复制黏贴即可，其余设置如图所示。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627031350.png)

### 检查Sonarr配置

逐一检查配置是否正确，以下图片为正确配置。

> 更新：新增影片质量配置。

#### 重命名配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627031454.png)

#### 根目录配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627031535.png)

#### 下载客户端配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627031610.png)

#### 刮削配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627031652.png)

#### 影片质量配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627031735.png)

> 图省事，所以只使用一个`Any`的配置。（多个当然更好）

### 检查Radarr配置

逐一检查配置是否正确，以下图片为正确配置。

> 更新：新增影片质量配置。

#### 重命名配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627031925.png)

#### 根目录配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627032017.png)

#### 下载客户端配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627032057.png)

#### 刮削配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627032140.png)

#### 影片质量配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627032218.png)

> 同样的；图省事，所以只使用一个`Any`的配置。（多个当然更好）

### 检查Lidarr配置

逐一检查配置是否正确，以下图片为正确配置。

#### 重命名以及根目录配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627032344.png)

#### 下载客户端配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627032429.png)

#### 刮削配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627032526.png)

#### 音乐质量配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627032641.png)

> 同样的；图省事，所以只使用一个`Any`的配置。（多个当然更好）

### 检查Readarr配置

逐一检查配置是否正确，以下图片为正确配置。

> **Readarr根目录有Bug，无法命令行配置，请手动配置。**

#### 重命名以及根目录配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627032929.png)

#### 仅需填入名称以及路径，其他不用改。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627033016.png)

#### 下载客户端配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627033057.png)

#### 书籍质量配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627033143.png)

### 检查Bazarr配置

逐一检查配置是否正确，以下图片为正确配置。

#### 字幕语言配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627033248.png)

#### 默认字幕语言配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627033336.png)

#### 下载字幕源

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627033418.png)

### 检查Chinesesubfinder配置

逐一检查配置是否正确，以下图片为正确配置。

> 更新：测试证明Chinesesubfinder也需要在`Docker-compose`配置文件中将卷目录挂载为`/data`才能正常工作(已修正)。

#### 基础配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627033606.png)

   1. 电影目录`/data/media/Movies`
   2. 连续剧目录`/data/media/Series`

#### Emby以及目录映射配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627033727.png)

### Prowlarr/Jackett配置indexers

> 操作流程和Jackett基本一毛一样，不再重复写了。

#### 点击`Add indexer`

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627033922.png)

#### 选择`Base Url`，点击保存。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627034020.png)

#### 有`Cloudflare DDOS`的要加一个`flaresolverr` Tag。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627034127.png)

### 检查qBittorrent配置

逐一检查配置是否正确，以下图片为正确配置。

#### 检查分类是否正确显示

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627034226.png)

#### 检查公开追踪器是否正常获取

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627034436.png)

#### 检查默认下载位置以及下载模式

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627034542.png)

### 配置NZBGet服务器

> 更新：新增程序缓存及下载队列相关内容。

#### 输入Usenet Provider域名，端口号，用户名以及密码等信息。

> 请严格按照你的Usenet Provider的指示填写，图片仅供参考。

> 如本地无IPv6连接，请将Server1.Ipversion手动设置为Ipv4以避免不必要的延迟。

> 更新：经测试原版NZBGet不支援`TLS1.3`协议。所以构建了一个独立的[Docker image](https://hub.docker.com/r/johnrosen/nzbget)以支援`TLS1.3`。`Cipher`建议设置为`ECDHE-ECDSA-AES128-GCM-SHA256`|`TLS1.2`，`TLS_AES_128_GCM_SHA256`|`TLS1.3`。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627035044.png)

#### 检查分类是否正确

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627035131.png)

> 更新：此数值经测试为单个文件的下载连接数，建议设置为`1`。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627035228.png)

#### 检查下载位置是否正确

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627035316.png)

#### 检查程序缓存以及最大下载队列是否正确

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627035418.png)

#### `TLS1.3`测试结果

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627035510.png)

#### 开启`DirectUnpack`提升下载效率

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627035559.png)

#### 检查重试次数

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627035643.png)

### 检查Rsshub配置

如看见下图，则Rsshub已可用。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627035744.png)

### 配置XRAY透明代理加系统代理

一个个应用程序配置http代理设置太麻烦了（并且不可靠），所以我选择透明代理。

> 本篇仅代理 22 80 443 563 端口。

`(*^▽^*)`总不能有人看到这里了还不会自己下载github release吧？

```url
https://github.com/XTLS/Xray-core/releases/
```

#### 参考systemd配置

```sh
  cat > "/etc/systemd/system/xray.service" << "EOF"
[Unit]
Description=Xray Service
Wants=network-online.target
After=network-online.target nss-lookup.target

[Service]
Type=simple
User=root
ExecStart=/etc/xray/xray -c /etc/xray/config.json
TimeoutStopSec=infinity
LimitNOFILE=65536
Restart=always
RestartSec=3s

[Install]
WantedBy=multi-user.target
EOF
```

#### iptables配置

> 更新：新增`IPv6`配置。

#### 安装ipset

```sh
apt install -y ipset
```

#### 新增内网ip段

```sh
ipset create private hash:net
ipset add private 172.17.0.0/16
ipset add private 172.18.0.0/16
ipset add private 127.0.0.0/8
ipset add private 10.0.0.0/8
ipset add private 172.16.0.0/12
ipset add private 192.168.0.0/16
ipset add private 224.0.0.0/4
ipset add private 240.0.0.0/4
ipset list
```

#### 新增中国大陆ip段

```sh
ipset -N china hash:net
curl -LO https://raw.githubusercontent.com/17mon/china_ip_list/master/china_ip_list.txt
for i in $(cat ./china_ip_list.txt ); do ipset -A china $i; done
ipset list china
```

#### IPv4配置

```sh
iptables -t nat -N XRAY
# 直连内网,中国大陆及本机 ip
iptables -t nat -A XRAY -m set –match-set private dst -j RETURN
iptables -t nat -A XRAY -m set –match-set china dst -j RETURN
# 直连 vps doh ip
iptables -t nat -A XRAY -d {vps ip} -j RETURN
iptables -t nat -A XRAY -d 223.5.5.5/32 -j RETURN
iptables -t nat -A XRAY -p tcp -j RETURN -m mark --mark 0x80
# 仅透明代理 22 80 443 563 端口
iptables -t nat -A XRAY -p tcp --dport 22 -j REDIRECT --to-ports 12345
iptables -t nat -A XRAY -p tcp --dport 80 -j REDIRECT --to-ports 12345
iptables -t nat -A XRAY -p tcp --dport 443 -j REDIRECT --to-ports 12345
iptables -t nat -A XRAY -p tcp --dport 563 -j REDIRECT --to-ports 12345
# 其余TCP流量直连
iptables -t nat -A XRAY -p tcp -j RETURN 
# 对局域网其他设备进行透明代理
iptables -t nat -A PREROUTING -p tcp -j XRAY 
# 对本机进行透明代理
iptables -t nat -A OUTPUT -p tcp -j XRAY 
iptables -t nat -N XRAY
```

#### IPv6配置（可选项）

```sh
iptables -t nat -I OUTPUT -p tcp --dport 123 -j RETURN
ip6tables -t nat -N XRAY
ip6tables -t nat -A XRAY -p tcp -j RETURN -m mark --mark 0xff
ip6tables -t nat -A XRAY -p tcp --dport 80 -j REDIRECT --to-ports 12345
ip6tables -t nat -A XRAY -p tcp --dport 443 -j REDIRECT --to-ports 12345
ip6tables -t nat -A XRAY -p tcp --dport 563 -j REDIRECT --to-ports 12345
ip6tables -t nat -A XRAY -p tcp -j RETURN 
ip6tables -t nat -A PREROUTING -p tcp -j XRAY 
ip6tables -t nat -A OUTPUT -p tcp -j XRAY
```

#### 查看iptables情况

```sh
iptables -t nat -L -v -n
```

#### 持久化ipset以及iptables

> 全选yes

```sh
apt install -y ipset iptables netfilter-persistent ipset-persistent iptables-persistent
```

> 更新：新增手动保存`iptables`方法。

#### 手动保存`iptables`

```sh
iptables-save > /etc/iptables/rules.v4
ip6tables-save > /etc/iptables/rules.v6
ipset save > /etc/iptables/ipsets
```

#### Xray配置

```sh
mkdir /etc/xray
sudo vim /etc/xray/config.json
```

```
{
    "log": {
      "loglevel": "info"
    },
    "dns": {
      "servers": [
        "https://1.12.12.12/dns-query",
        "https://120.53.53.53/dns-query",
        {
          "address": "https://1.1.1.1:443/dns-query",
          "domains": [
            "geosite:geolocation-!cn" // DNS 分流，国外大站走国外 DNS
          ]
        }
      ],
      "tag": "dns"
    },
    "inbounds": [
      {
        "listen": "127.0.0.1",
        "port": 6666,
        "protocol": "http", // http 代理
        "sniffing": {
          "enabled": true,
          "destOverride": [
            "http",
            "tls"
          ],
          "metadataOnly": false
        },
        "allocate": {
          "strategy": "always",
          "refresh": 5,
          "concurrency": 3
        }
        },
      {
        "listen": "127.0.0.1",
        "port": 1080,
        "protocol": "socks", // socks 代理
        "udp": true,
        "sniffing": {
          "enabled": true,
          "destOverride": [
            "http",
            "tls"
          ],
          "metadataOnly": false
        },
        "allocate": {
          "strategy": "always",
          "refresh": 5,
          "concurrency": 3
        }
        },
        {
          "port": 12345,
          "protocol": "dokodemo-door", // 透明代理
          "settings": {
            "network": "tcp,udp",
            "followRedirect": true
          },
          "sniffing": {
            "enabled": true,
            "destOverride": ["http", "tls"]
          },
        "allocate": {
          "strategy": "always",
          "refresh": 5,
          "concurrency": 3
          }
        }
      ],
    "outbounds": [
      {
        "protocol": "vless", //你的服务器协议
        "settings": {
          "vnext": [
            {
              "address": "1.1.1.1", //你的服务器ip
              "port": 443, // 你的服务器端口号
              "users": [
                {
                  "encryption": "none",
                  "flow": "",
                  "id": "55547476-bb06-5f2b-bceb-fff49978fd99", //你的服务器密码
                  "level": 0
                }
              ]
            }
          ]
        },
        "tag": "proxy", // 流量代理出口
        "streamSettings": {
          "grpcSettings": {
            "multiMode": true,
            "serviceName": "grpc" // grpc ServiceName
          },
          "network": "grpc", // 你的服务器底层协议
          "security": "tls", // 底层传输协议
          "tlsSettings": {
              "serverName": "adminadmin.com", //你的服务器域名
              "rejectUnknownSni": false,
              "allowInsecure": false,
              "alpn": ["h2", "http/1.1"],
              "minVersion": "1.2",
              "maxVersion": "1.3",
              "cipherSuites": "TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA:AES256-SHA",
              "disableSystemRoot": false,
              "enableSessionResumption": false
            },
            "sockopt": {
              "mark": 128
            }
          }
        },
        {
          "protocol": "freedom", // 流量直连出口
          "settings": {},
          "tag": "direct",
          "streamSettings": {
            "sockopt": {
              "mark": 128
            }
          }
        },
        {
          "tag": "blocked", // 流量屏蔽出口
          "protocol": "blackhole",
          "settings": {},
          "streamSettings": {
            "sockopt": {
              "mark": 128
            }
          }
        }],
        "routing": {
            "domainStrategy": "IPIfNonMatch",
            "domainMatcher": "mph",
            "rules": [
                {
                  "type": "field",
                  "protocol": ["bittorrent"], // BT 直连
                  "outboundTag": "direct"
                },
                {
                  "type": "field",
                  "outboundTag": "direct",
                  "domain": ["regexp:tracker\\w*\\."] // BT Tracker 直连
                },
                {
                  "type": "field",
                  "domain": ["geosite:category-ads"], // 屏蔽广告
                  "outboundTag": "blocked"
                },
                {
                  "type": "field",
                  "domain": ["geosite:cn"], // 国内直连
                  "outboundTag": "direct"
                },
                {
                  "type": "field",
                  "ip": ["geoip:cn","geoip:private"], // 内网直连
                  "outboundTag": "direct"
                }
        ]
    }
  }
```

#### 启动XRAY

```sh
systemctl enable xray --now
```

#### 设置DNS域名为：`1.1.1.1`以及：`1.0.0.1`

```sh
echo "nameserver 1.1.1.1" > /etc/resolv.conf
echo "nameserver 1.0.0.1" >> /etc/resolv.conf
```

#### 设置系统代理

```sh
vim /etc/profile.d/proxy.sh
```

写入以下内容

```sh
export http_proxy="http://127.0.0.1:6666/"
export https_proxy="http://127.0.0.1:6666/"
export ftp_proxy="http://127.0.0.1:6666/"
```

```txt
esc :wq 保存退出
```

#### 测试透明代理是否成功

> 见到如下返回则已成功

```sh
root@debian:~# curl google.com
<HTML><HEAD><meta http-equiv="content-type" content="text/html;charset=utf-8">
<TITLE>301 Moved</TITLE></HEAD><BODY>
<H1>301 Moved</H1>
The document has moved
<A HREF="http://www.google.com/">here</A>.
</BODY></HTML>
root@debian:~# 
```

### 配置[Overture](https://github.com/shawn1m/overture)以实现DNS国内分流

> 更新：新增`Redis`配置。

`Redis`用于持久化DNS缓存，避免重启服务后缓存丢失。

```sh
curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/redis.list
apt-get update
apt-get install redis -y
systemctl enable redis-server
# 启用持久化缓存
sed -i "s/appendonly no/appendonly yes/g" /etc/redis/redis.conf
# 新增Domain socket配置
echo "unixsocket /var/run/redis/redis.sock" >> /etc/redis/redis.conf
echo "unixsocketperm 770" >> /etc/redis/redis.conf
systemctl restart redis-server
```

因为GFWlist以及cniplist太长，写不下,直接放结果，想看的自己去看src。

```url
https://raw.githubusercontent.com/johnrosen1/vpstoolbox/master/install/overture.sh
```

#### 安装Overture

```sh
curl -LO https://raw.githubusercontent.com/johnrosen1/vpstoolbox/master/install/overture.sh
source overture.sh
install_overture
```

#### 主配置文件`/etc/overture/config.yml`

> 默认走`Ali DOH`，国外IP及域名走`Cloudflare DOH`(通过代理) 。

```yml
bindAddress: :53
debugHTTPAddress: 127.0.0.1:5555
dohEnabled: false
primaryDNS:
  - name: Ali
    address: https://223.5.5.5/dns-query
    protocol: https
    socks5Address:
    timeout: 6
    ednsClientSubnet:
      policy: disabled
      externalIP:
      noCookie: true
alternativeDNS:
  - name: Cloudflare
    address: https://1.1.1.1/dns-query
    protocol: https
    socks5Address: 127.0.0.1:1080
    timeout: 60
    ednsClientSubnet:
      policy: disabled
      externalIP:
      noCookie: true
onlyPrimaryDNS: false
ipv6UseAlternativeDNS: false
alternativeDNSConcurrent: false
whenPrimaryDNSAnswerNoneUse: alternativeDNS
ipNetworkFile:
  primary: /etc/overture/china_ip_list.txt
  alternative: /etc/overture/ip_network_alternative_sample
domainFile:
  primary: /etc/overture/chnlist.txt
  alternative: /etc/overture/gfw_all_domain.txt
  matcher: /etc/overture/suffix-tree
hostsFile:
  hostsFile: /etc/overture/hosts_sample
  finder: /etc/overture/full-map
minimumTTL: 0
domainTTLFile: /etc/overture/domain_ttl_sample
cacheSize: 10000
cacheRedisUrl: unix:///var/run/redis/redis.sock
cacheRedisConnectionPoolSize: 1000000
rejectQType:
  - 255
```

#### 启用分流

```sh
echo "nameserver 127.0.0.1" > /etc/resolv.conf
```

#### 锁定配置，防止重启失效

```sh
chattr +i /etc/resolv.conf
```

#### 测试是否成功

> 出现以下显示则成功

```sh
root@debian:~# nslookup baidu.com
Server:		127.0.0.1
Address:	127.0.0.1#53

Non-authoritative answer:
Name:	baidu.com
Address: 220.181.38.148
Name:	baidu.com
Address: 220.181.38.251

root@debian:~# nslookup google.com
Server:		127.0.0.1
Address:	127.0.0.1#53

Non-authoritative answer:
Name:	google.com
Address: 172.217.31.174
Name:	google.com
Address: 2404:6800:4004:824::200e

root@debian:~# 
```

### 设置CPU策略为最佳性能

> 更新：新增开机全自动化设置内容。

```sh
apt install linux-cpupower -y
sudo cpupower frequency-set -g performance
```

#### 查看当前策略

```sh
cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
```

#### 设置开机启动

```sh
  cat > "/etc/systemd/system/cpupower.service" << "EOF"
[Unit]
Description=CPU performance mode
[Service]
Type=oneshot
ExecStart=/usr/bin/cpupower frequency-set -g performance
[Install]
WantedBy=multi-user.target
EOF
```

#### 使配置生效

```sh
systemctl enable cpupower
```

### 挂载SSD并设置写入缓存

> 建议使用大容量固态硬盘作为qBittorrent以及NZBGet的写入缓存。

#### 新增挂载点

```sh
mkdir /ssd
```

#### 查看硬件信息，记下`/dev/sda`

```sh
fdisk -l
```

```sh
Disk /dev/sda: 931.51 GiB, 1000204886016 bytes, 1953525168 sectors
Disk model: ************
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
```

#### 新增分区

```sh
cfdisk /dev/sda
```

#### 选择`gpt`

```sh
> New -> Primary -> 回车
> Write -> yes
> Quit
```

#### 使用`Ext4`文件系统格式化

```sh
mkfs.ext4 /dev/sda
```

#### 获取硬件`UUID`

```sh
blkid
```

```sh
/dev/sda: UUID="8168d321-c245-4846-82dd-a5d79a04550a" BLOCK_SIZE="4096" TYPE="ext4"
```

#### 修改`/etc/fstab`，新增以下内容

```sh
UUID=359d90df-f17a-42f6-ab13-df13bf356de7 /ssd ext4 errors=remount-ro 0 1
```

#### 挂载SSD至挂载点

```sh
mount /ssd
```

#### 查看挂载是否成功

```sh
root@debian:~# df -hl
...
/dev/sda        916G   20K  916G    1% /ssd # 出现这行就代表成功
...
```

#### qBittorrent配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627133153.png)

#### NZBGet配置

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627133243.png)

### 最大化可用空间

`ext4`默认有`5%`的预留空间，我们的数据盘和缓存盘不需要这种东西，只有系统盘会需要。

#### 取消预留空间

```sh
tune2fs -m 0 /dev/sda
```

### 开启BBR提升网络质量

```sh
  cat > '/etc/sysctl.d/99-sysctl.conf' << EOF
net.ipv4.conf.all.route_localnet=1
net.ipv4.ip_forward = 1
net.ipv4.conf.all.forwarding = 1
net.ipv4.conf.default.forwarding = 1
net.ipv6.conf.all.forwarding = 1
net.ipv6.conf.default.forwarding = 1
net.ipv6.conf.lo.forwarding = 1
net.ipv6.conf.all.disable_ipv6 = 0
net.ipv6.conf.default.disable_ipv6 = 0
net.ipv6.conf.lo.disable_ipv6 = 0
net.ipv6.conf.all.accept_ra = 2
net.ipv6.conf.default.accept_ra = 2
net.core.netdev_max_backlog = 100000
net.core.netdev_budget = 50000
net.core.netdev_budget_usecs = 5000
#fs.file-max = 51200
net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.core.rmem_default = 67108864
net.core.wmem_default = 67108864
net.core.optmem_max = 65536
net.core.somaxconn = 1000000
net.ipv4.icmp_echo_ignore_all = 0
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.conf.default.rp_filter = 0
net.ipv4.conf.all.rp_filter = 0
net.ipv4.tcp_keepalive_time = 600
net.ipv4.tcp_keepalive_intvl = 15
net.ipv4.tcp_keepalive_probes = 2
net.ipv4.tcp_synack_retries = 1
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_rfc1337 = 0
net.ipv4.tcp_timestamps = 1
net.ipv4.tcp_tw_reuse = 0
net.ipv4.tcp_fin_timeout = 15
net.ipv4.ip_local_port_range = 1024 65535
net.ipv4.tcp_max_tw_buckets = 5000
net.ipv4.tcp_fastopen = 4
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864
net.ipv4.udp_rmem_min = 8192
net.ipv4.udp_wmem_min = 8192
net.ipv4.tcp_mtu_probing = 1
net.ipv4.tcp_autocorking = 0
net.ipv4.tcp_slow_start_after_idle = 0
net.ipv4.tcp_max_syn_backlog = 819200
net.ipv4.tcp_notsent_lowat = 16384
net.ipv4.tcp_no_metrics_save = 0
net.ipv4.tcp_ecn = 1
net.ipv4.tcp_ecn_fallback = 1
net.ipv4.tcp_frto = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0
net.ipv4.neigh.default.gc_thresh3=8192
net.ipv4.neigh.default.gc_thresh2=4096
net.ipv4.neigh.default.gc_thresh1=2048
net.ipv6.neigh.default.gc_thresh3=8192
net.ipv6.neigh.default.gc_thresh2=4096
net.ipv6.neigh.default.gc_thresh1=2048
net.ipv4.tcp_orphan_retries = 1
net.ipv4.tcp_retries2 = 5
vm.swappiness = 1
vm.overcommit_memory = 1
kernel.pid_max=64000
net.netfilter.nf_conntrack_max = 262144
net.nf_conntrack_max = 262144
## Enable bbr
net.core.default_qdisc = fq
net.ipv4.tcp_congestion_control = bbr
EOF
sysctl -p
```

### 修改最大开启文件数上限

> 这一步主要是为了避免`Too much open files`的错误。

```sh
  cat > '/etc/systemd/system.conf' << EOF
[Manager]
#DefaultTimeoutStartSec=90s
DefaultTimeoutStopSec=30s
#DefaultRestartSec=100ms
DefaultLimitCORE=infinity
DefaultLimitNOFILE=infinity
EOF
    cat > '/etc/security/limits.conf' << EOF
root     soft   nofile    1000000
root     hard   nofile    1000000
root     soft   nproc     unlimited
root     hard   nproc     unlimited
root     soft   core      unlimited
root     hard   core      unlimited
root     hard   memlock   unlimited
root     soft   memlock   unlimited

*     soft   nofile    1000000
*     hard   nofile    1000000
*     soft   nproc     unlimited
*     hard   nproc     unlimited
*     soft   core      unlimited
*     hard   core      unlimited
*     hard   memlock   unlimited
*     soft   memlock   unlimited
EOF
sed -i '/ulimit -SHn/d' /etc/profile
echo "ulimit -SHn 1000000" >> /etc/profile
echo "session required pam_limits.so" >> /etc/pam.d/common-session
systemctl daemon-reload
```

> 如果不放心生没生效，可以重启一次`reboot`就生效了。

### 绑定DHCP内网地址

> 不想手动设置`/etc/network/interfaces`? TP-link IP 与 mac 绑定你值得拥有。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627133632.png)

### 开启Upnp/DMZ

> 开启Upnp/DMZ可以极大地加速BT/PT下载上传(前提是你有公网IP)。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627133737.png)

DMZ主机IP地址请填你的NAS内网地址。

### 开启Emby硬解

> Emby硬解需要Emby会员订阅。

![image](https://cdn.jsdelivr.net/gh/mayjack0312/image@main/2022/06/27/20220627133848.png)

我的机器是`Intel`核显，所以把`QuickSync Intel`设为首选。

### 安装可能缺少的固件

> 此配置仅适用于本地NAS。

```sh
apt-get install firmware-linux -y
```

### 最大化网卡RX/TX缓冲

> 此配置仅适用于本地NAS，建议设置为网卡支持的最大值。

```sh
apt install ethtool -y
ip a
ethtool -g ethX
ethtool -G ethX rx 最大值 tx 最大值
```

这个设置重启后会失效，建议使用`rc.local`等解决方案实现开机自动设置。

## 推荐的安卓客户端

[Nzb360 Pro](https://play.google.com/store/apps/details?id=com.kevinforeman.nzb360)

没有中文但功能强大。

> The best usenet / torrent manager on Android.

